---
layout: single
title: "Profit Time Series"
categories: SL
tag: [LSTM, Prophet, Time Series]
toc: true
toc_sticky: true
toc_label: "GITHUB BLOG JJUNS"
#author_profile: false
header:
    teaser: /assets/images/posts/dl-thumbnail.jpg
sidebar:
    nav: "docs"
---

# Code
**[Notice]** [download here](https://github.com/hchoi256/machine-learning-development)
{: .notice--danger}

# Learning Goals
**시계열 예측**을 위한 **페이스북 Propjet** 이해 <span style="color: blue"> Understanding **Facebook Propjet** for **Time Series Prediction** </span>

# PART 1: Chicago Crime Rate
![image](https://user-images.githubusercontent.com/39285147/180627186-59e3e369-89c7-4607-b533-0f62794fcde8.png)

## Description
절도범이 어느 시간대에 가장 잘 잡히는지, 범죄율이 올라가는 가장 높은 시간대는 언제인지 등을 관찰해보고 Prophet 활용하여 미래 'Crime' 결과도 예측해본다. <span style="color: blue"> Observing when thieves are best caught and when the crime rate rises the most, and predict future 'Crime' results using Prophet. </span>

## Observing the dataset
**Dataset contains the following columns**: 
- ID: Unique identifier for the record.
- Case Number: The Chicago Police Department RD Number (Records Division Number), which is unique to the incident.
- Date: Date when the incident occurred.
- Block: address where the incident occurred
- IUCR: The Illinois Unifrom Crime Reporting code.
- Primary Type: The primary description of the IUCR code.
- Description: The secondary description of the IUCR code, a subcategory of the primary description.
- Location Description: Description of the location where the incident occurred.
- Arrest: Indicates whether an arrest was made.
- Domestic: Indicates whether the incident was domestic-related as defined by the Illinois Domestic Violence Act.
- Beat: Indicates the beat where the incident occurred. A beat is the smallest police geographic area – each beat has a dedicated police beat car. 
- District: Indicates the police district where the incident occurred. 
- Ward: The ward (City Council district) where the incident occurred. 
- Community Area: Indicates the community area where the incident occurred. Chicago has 77 community areas. 
- FBI Code: Indicates the crime classification as outlined in the FBI's National Incident-Based Reporting System (NIBRS). 
- X Coordinate: The x coordinate of the location where the incident occurred in State Plane Illinois East NAD 1983 projection. 
- Y Coordinate: The y coordinate of the location where the incident occurred in State Plane Illinois East NAD 1983 projection. 
- Year: Year the incident occurred.
- Updated On: Date and time the record was last updated.
- Latitude: The latitude of the location where the incident occurred. This location is shifted from the actual location for partial redaction but falls on the same block.
- Longitude: The longitude of the location where the incident occurred. This location is shifted from the actual location for partial redaction but falls on the same block.
- Location: The location where the incident occurred in a format that allows for creation of maps and other geographic operations on this data portal. This location is shifted from the actual location for partial redaction but falls on the same block.

**Datasource**: https://www.kaggle.com/currie32/crimes-in-chicago

## Loading the dataset

```python
import pandas as pd 
import numpy as np 
import matplotlib.pyplot as plt
import random
import seaborn as sns
from fbprophet import Prophet

```

```python
# training and testing datasets 
chicago_df_1 = pd.read_csv('Chicago_Crimes_2005_to_2007.csv', error_bad_lines=False) # error_bad_lines: 손상된 줄이나 누락된 행을 무시한다 Ignoring corrupted or missing lines
chicago_df_2 = pd.read_csv('Chicago_Crimes_2008_to_2011.csv', error_bad_lines=False)
chicago_df_3 = pd.read_csv('Chicago_Crimes_2012_to_2017.csv', error_bad_lines=False)


chicago_df = pd.concat([chicago_df_1, chicago_df_2, chicago_df_3], ignore_index=False, axis=0) # concatnate dataframes

```

## Organizing the dataset

```python
# 불필요한 열 제거하기
chicago_df.drop(['Unnamed: 0', 'Case Number', 'Case Number', 'IUCR', 'X Coordinate', 'Y Coordinate','Updated On','Year', 'FBI Code', 'Beat','Ward','Community Area', 'Location', 'District', 'Latitude' , 'Longitude'], inplace=True, axis=1)
```

> *inplace*: 메모리에서 실제열(= 불필요한열)을 삭제한다 <span style="color: blue"> Delete real rows (= unnecessary rows) from memory
>
> *axis=1*: 전체 열을 탈락시킨다<span style="color: blue"> dissipating all heat</span>

하기 코드는 이 프로젝트의 시계열 처리에 수반되는 전처리 과정이다.<span style="color: blue"> The following code is the preprocessing process involved in the time series processing of this project. </span>

```python
# Date 형식 수정 Modifying Date Format
chicago_df.Date = pd.to_datetime(chicago_df.Date, format='%m/%d/%Y %I:%M:%S %p')

# Date을 인덱스로 활용한다 Usnig Date as an index
chicago_df.index = pd.DatetimeIndex(chicago_df.Date)

```

> *DatetimeIndex*: 특정한 순간에 기록된 타임스탬프(timestamp) 형식의 시계열 자료를 다루기 위한 인덱스 <span style="color: blue"> Index for handling time series data in timestamp format recorded at a specific moment</span>

## Data Visualization

```python
plt.figure(figsize=(10,10))
sns.heatmap(chicago_df.isnull(), cbar = False, cmap = 'YlGnBu')
```

![image](https://user-images.githubusercontent.com/39285147/180625915-a5c5d201-7976-403e-9dec-3ee4d1261c6a.png)


```python
# 어떤 종류의 폭력이 가장 많이 발생했나 What kind of violence occurred the most
plt.figure(figsize = (15, 10))
sns.countplot(y= 'Primary Type', data = chicago_df, order = chicago_df['Primary Type'].value_counts().iloc[:15].index)
```

![image](https://user-images.githubusercontent.com/39285147/180626028-84e51093-bcb4-40a8-99ea-575d68f0a53f.png)


'MOTOR VEHICLE THEFT' 대략 20만 여개의 차량이 도난됐다. <span style="color: blue">'MOTOR VEHICLE THEFT' About 200,000 vehicles were stolen. </span>


```python
# 어느 지역에서 가장 폭력이 많이 발생했는가 Which region has the most violence?
plt.figure(figsize = (15, 10))
sns.countplot(y= 'Location Description', data = chicago_df, order = chicago_df['Location Description'].value_counts().iloc[:15].index)
```

![image](https://user-images.githubusercontent.com/39285147/182013808-c0f8a601-7e9e-4599-9b2e-75098fdc4cb9.png)


'거리'에서 발생한 폭력이 가장 많은 것을 확인해볼 수 있다. <span style="color: blue"> It can be seen that the most violence occurred on the 'street'.</span>

```python
# 특정 연도에 범죄가 얼마나 발생했나 How many crimes occurred in a particular year
plt.plot(chicago_df.resample('Y').size()) # 연도(Y) 기준으로 resample하여 특정 연도에 발생한 샘플 개수(사건 수)를 도출 Resampling based on year (Y) to derive # samples (# events) that occurred in a specific year
plt.title('Crimes Count Per Year')
plt.xlabel('Years')
plt.ylabel('Number of Crimes')
```

![image](https://user-images.githubusercontent.com/39285147/180626221-6bc29e6a-a714-4dda-8654-54085509b499.png)


        Date
        2005-12-31    455811
        2006-12-31    794684
        2007-12-31    621848
        2008-12-31    852053
        2009-12-31    783900
        2010-12-31    700691
        2011-12-31    352066
        2012-12-31    335670
        2013-12-31    306703
        2014-12-31    274527
        2015-12-31    262995
        2016-12-31    265462
        2017-12-31     11357


```python
# 특정 달에 범죄가 얼마나 발생했나 How many crimes occurred in a particular month
plt.plot(chicago_df.resample('M').size())
plt.title('Crimes Count Per Month')
plt.xlabel('Months')
plt.ylabel('Number of Crimes')
```


![image](https://user-images.githubusercontent.com/39285147/180626249-77bc4292-b858-4436-a7d1-16f7dd213c7d.png)



```python
# 특정 분기에 범죄가 얼마나 발생했나 How many crimes occurred in a particular quarter
plt.plot(chicago_df.resample('Q').size())
plt.title('Crimes Count Per Quarter')
plt.xlabel('Quarters')
plt.ylabel('Number of Crimes')
```

![image](https://user-images.githubusercontent.com/39285147/180626270-d43dbc75-697e-44e0-896c-a83cb635d75a.png)

## Data Preprocessing

```python
chicago_prophet = chicago_df.resample('M').size().reset_index() # 인덱스화 되어있는 테이블을 초기화시킨다 Initializing an indexed table
chicago_prophet.columns = ['Date', 'Crime Count']
chicago_prophet_df = pd.DataFrame(chicago_prophet)
chicago_prophet_df_final = chicago_prophet_df.rename(columns={'Date':'ds', 'Crime Count':'y'})
```

![image](https://user-images.githubusercontent.com/39285147/180626349-87d721fd-31fc-4964-aabf-3fa9febbc6bd.png)


## Prediction

```python
m = Prophet() # 'Crime의' 미래를 예측하는 역할 Predicting the future of 'Crime'
m.fit(chicago_prophet_df_final)

# Forcasting into the future
future = m.make_future_dataframe(periods=365) # 앞으로 1년 동안의 'Crime'을 Prophet 활용하여 예측 Prediction using Prophet 'Crime' for the next year
forecast = m.predict(future)
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ds</th>
      <th>trend</th>
      <th>yhat_lower</th>
      <th>yhat_upper</th>
      <th>trend_lower</th>
      <th>trend_upper</th>
      <th>additive_terms</th>
      <th>additive_terms_lower</th>
      <th>additive_terms_upper</th>
      <th>yearly</th>
      <th>yearly_lower</th>
      <th>yearly_upper</th>
      <th>multiplicative_terms</th>
      <th>multiplicative_terms_lower</th>
      <th>multiplicative_terms_upper</th>
      <th>yhat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2005-01-31</td>
      <td>60454.550849</td>
      <td>38579.873129</td>
      <td>72458.344880</td>
      <td>60454.550849</td>
      <td>60454.550849</td>
      <td>-4762.896867</td>
      <td>-4762.896867</td>
      <td>-4762.896867</td>
      <td>-4762.896867</td>
      <td>-4762.896867</td>
      <td>-4762.896867</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>55691.653982</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2005-02-28</td>
      <td>60322.147047</td>
      <td>34221.041714</td>
      <td>67421.454566</td>
      <td>60322.147047</td>
      <td>60322.147047</td>
      <td>-9500.949898</td>
      <td>-9500.949898</td>
      <td>-9500.949898</td>
      <td>-9500.949898</td>
      <td>-9500.949898</td>
      <td>-9500.949898</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>50821.197149</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2005-03-31</td>
      <td>60175.557124</td>
      <td>42823.370306</td>
      <td>75698.921616</td>
      <td>60175.557124</td>
      <td>60175.557124</td>
      <td>-1224.296867</td>
      <td>-1224.296867</td>
      <td>-1224.296867</td>
      <td>-1224.296867</td>
      <td>-1224.296867</td>
      <td>-1224.296867</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>58951.260257</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2005-04-30</td>
      <td>60033.695908</td>
      <td>44555.300811</td>
      <td>79384.772219</td>
      <td>60033.695908</td>
      <td>60033.695908</td>
      <td>1182.976012</td>
      <td>1182.976012</td>
      <td>1182.976012</td>
      <td>1182.976012</td>
      <td>1182.976012</td>
      <td>1182.976012</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>61216.671919</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2005-05-31</td>
      <td>59887.105985</td>
      <td>49410.229024</td>
      <td>81613.777868</td>
      <td>59887.105985</td>
      <td>59887.105985</td>
      <td>5498.632207</td>
      <td>5498.632207</td>
      <td>5498.632207</td>
      <td>5498.632207</td>
      <td>5498.632207</td>
      <td>5498.632207</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>65385.738191</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2005-06-30</td>
      <td>59745.244769</td>
      <td>47098.245873</td>
      <td>78678.030782</td>
      <td>59745.244769</td>
      <td>59745.244769</td>
      <td>3577.501610</td>
      <td>3577.501610</td>
      <td>3577.501610</td>
      <td>3577.501610</td>
      <td>3577.501610</td>
      <td>3577.501610</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>63322.746379</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2005-07-31</td>
      <td>59598.654838</td>
      <td>47806.382068</td>
      <td>80665.905762</td>
      <td>59598.654838</td>
      <td>59598.654838</td>
      <td>4583.361194</td>
      <td>4583.361194</td>
      <td>4583.361194</td>
      <td>4583.361194</td>
      <td>4583.361194</td>
      <td>4583.361194</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>64182.016032</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2005-08-31</td>
      <td>59452.064908</td>
      <td>47368.296071</td>
      <td>80756.033012</td>
      <td>59452.064908</td>
      <td>59452.064908</td>
      <td>4499.375562</td>
      <td>4499.375562</td>
      <td>4499.375562</td>
      <td>4499.375562</td>
      <td>4499.375562</td>
      <td>4499.375562</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>63951.440470</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2005-09-30</td>
      <td>59310.203685</td>
      <td>44535.626188</td>
      <td>77006.014932</td>
      <td>59310.203685</td>
      <td>59310.203685</td>
      <td>1749.549105</td>
      <td>1749.549105</td>
      <td>1749.549105</td>
      <td>1749.549105</td>
      <td>1749.549105</td>
      <td>1749.549105</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>61059.752790</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2005-10-31</td>
      <td>59163.613755</td>
      <td>45431.878281</td>
      <td>78473.609767</td>
      <td>59163.613755</td>
      <td>59163.613755</td>
      <td>2397.346677</td>
      <td>2397.346677</td>
      <td>2397.346677</td>
      <td>2397.346677</td>
      <td>2397.346677</td>
      <td>2397.346677</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>61560.960432</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2005-11-30</td>
      <td>59021.752529</td>
      <td>39855.843322</td>
      <td>73045.342043</td>
      <td>59021.752529</td>
      <td>59021.752529</td>
      <td>-2065.033670</td>
      <td>-2065.033670</td>
      <td>-2065.033670</td>
      <td>-2065.033670</td>
      <td>-2065.033670</td>
      <td>-2065.033670</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>56956.718858</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2005-12-31</td>
      <td>58875.162595</td>
      <td>35993.544575</td>
      <td>71131.998977</td>
      <td>58875.162595</td>
      <td>58875.162595</td>
      <td>-5992.119657</td>
      <td>-5992.119657</td>
      <td>-5992.119657</td>
      <td>-5992.119657</td>
      <td>-5992.119657</td>
      <td>-5992.119657</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>52883.042938</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2006-01-31</td>
      <td>58728.572661</td>
      <td>36668.886036</td>
      <td>70839.471318</td>
      <td>58728.572661</td>
      <td>58728.572661</td>
      <td>-4772.659269</td>
      <td>-4772.659269</td>
      <td>-4772.659269</td>
      <td>-4772.659269</td>
      <td>-4772.659269</td>
      <td>-4772.659269</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>53955.913392</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2006-02-28</td>
      <td>58596.168850</td>
      <td>32430.561382</td>
      <td>65806.466898</td>
      <td>58596.168850</td>
      <td>58596.168850</td>
      <td>-9503.051717</td>
      <td>-9503.051717</td>
      <td>-9503.051717</td>
      <td>-9503.051717</td>
      <td>-9503.051717</td>
      <td>-9503.051717</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>49093.117133</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2006-03-31</td>
      <td>58449.578916</td>
      <td>39193.541836</td>
      <td>71919.946197</td>
      <td>58449.578916</td>
      <td>58449.578916</td>
      <td>-1224.434198</td>
      <td>-1224.434198</td>
      <td>-1224.434198</td>
      <td>-1224.434198</td>
      <td>-1224.434198</td>
      <td>-1224.434198</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>57225.144718</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2006-04-30</td>
      <td>58307.717686</td>
      <td>42625.987661</td>
      <td>77057.400277</td>
      <td>58307.717686</td>
      <td>58307.717686</td>
      <td>1187.100547</td>
      <td>1187.100547</td>
      <td>1187.100547</td>
      <td>1187.100547</td>
      <td>1187.100547</td>
      <td>1187.100547</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>59494.818233</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2006-05-31</td>
      <td>58161.127748</td>
      <td>45990.584105</td>
      <td>80277.571713</td>
      <td>58161.127748</td>
      <td>58161.127748</td>
      <td>5451.418874</td>
      <td>5451.418874</td>
      <td>5451.418874</td>
      <td>5451.418874</td>
      <td>5451.418874</td>
      <td>5451.418874</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>63612.546621</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2006-06-30</td>
      <td>58019.266517</td>
      <td>45778.759963</td>
      <td>79069.169730</td>
      <td>58019.266517</td>
      <td>58019.266517</td>
      <td>3564.138248</td>
      <td>3564.138248</td>
      <td>3564.138248</td>
      <td>3564.138248</td>
      <td>3564.138248</td>
      <td>3564.138248</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>61583.404765</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2006-07-31</td>
      <td>57872.676579</td>
      <td>47002.201998</td>
      <td>79782.570772</td>
      <td>57872.676579</td>
      <td>57872.676579</td>
      <td>4563.254349</td>
      <td>4563.254349</td>
      <td>4563.254349</td>
      <td>4563.254349</td>
      <td>4563.254349</td>
      <td>4563.254349</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>62435.930927</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2006-08-31</td>
      <td>57726.086594</td>
      <td>45447.102442</td>
      <td>79160.703585</td>
      <td>57726.086594</td>
      <td>57726.086594</td>
      <td>4479.990711</td>
      <td>4479.990711</td>
      <td>4479.990711</td>
      <td>4479.990711</td>
      <td>4479.990711</td>
      <td>4479.990711</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>62206.077306</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2006-09-30</td>
      <td>57584.225319</td>
      <td>41994.861861</td>
      <td>76377.523816</td>
      <td>57584.225319</td>
      <td>57584.225319</td>
      <td>1829.842795</td>
      <td>1829.842795</td>
      <td>1829.842795</td>
      <td>1829.842795</td>
      <td>1829.842795</td>
      <td>1829.842795</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>59414.068114</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2006-10-31</td>
      <td>57437.635335</td>
      <td>43300.623636</td>
      <td>77873.098798</td>
      <td>57437.635335</td>
      <td>57437.635335</td>
      <td>2439.830765</td>
      <td>2439.830765</td>
      <td>2439.830765</td>
      <td>2439.830765</td>
      <td>2439.830765</td>
      <td>2439.830765</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>59877.466100</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2006-11-30</td>
      <td>57295.774060</td>
      <td>38210.477095</td>
      <td>73388.386714</td>
      <td>57295.774060</td>
      <td>57295.774060</td>
      <td>-2045.360906</td>
      <td>-2045.360906</td>
      <td>-2045.360906</td>
      <td>-2045.360906</td>
      <td>-2045.360906</td>
      <td>-2045.360906</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>55250.413154</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2006-12-31</td>
      <td>57149.184075</td>
      <td>34675.761615</td>
      <td>67310.501555</td>
      <td>57149.184075</td>
      <td>57149.184075</td>
      <td>-6013.413267</td>
      <td>-6013.413267</td>
      <td>-6013.413267</td>
      <td>-6013.413267</td>
      <td>-6013.413267</td>
      <td>-6013.413267</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>51135.770808</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2007-01-31</td>
      <td>56994.480254</td>
      <td>35873.268789</td>
      <td>69294.200682</td>
      <td>56994.480254</td>
      <td>56994.480254</td>
      <td>-4783.036614</td>
      <td>-4783.036614</td>
      <td>-4783.036614</td>
      <td>-4783.036614</td>
      <td>-4783.036614</td>
      <td>-4783.036614</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>52211.443640</td>
    </tr>
    <tr>
      <th>25</th>
      <td>2007-02-28</td>
      <td>56854.747771</td>
      <td>29801.353956</td>
      <td>62906.688914</td>
      <td>56854.747771</td>
      <td>56854.747771</td>
      <td>-9501.921423</td>
      <td>-9501.921423</td>
      <td>-9501.921423</td>
      <td>-9501.921423</td>
      <td>-9501.921423</td>
      <td>-9501.921423</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>47352.826348</td>
    </tr>
    <tr>
      <th>26</th>
      <td>2007-03-31</td>
      <td>56700.043950</td>
      <td>38154.033064</td>
      <td>72707.777440</td>
      <td>56700.043950</td>
      <td>56700.043950</td>
      <td>-1225.266871</td>
      <td>-1225.266871</td>
      <td>-1225.266871</td>
      <td>-1225.266871</td>
      <td>-1225.266871</td>
      <td>-1225.266871</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>55474.777078</td>
    </tr>
    <tr>
      <th>27</th>
      <td>2007-04-30</td>
      <td>56550.330574</td>
      <td>40491.474353</td>
      <td>74706.900200</td>
      <td>56550.330574</td>
      <td>56550.330574</td>
      <td>1190.223261</td>
      <td>1190.223261</td>
      <td>1190.223261</td>
      <td>1190.223261</td>
      <td>1190.223261</td>
      <td>1190.223261</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>57740.553835</td>
    </tr>
    <tr>
      <th>28</th>
      <td>2007-05-31</td>
      <td>56395.626753</td>
      <td>45020.807451</td>
      <td>77993.605388</td>
      <td>56395.626753</td>
      <td>56395.626753</td>
      <td>5402.206493</td>
      <td>5402.206493</td>
      <td>5402.206493</td>
      <td>5402.206493</td>
      <td>5402.206493</td>
      <td>5402.206493</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>61797.833246</td>
    </tr>
    <tr>
      <th>29</th>
      <td>2007-06-30</td>
      <td>56230.582698</td>
      <td>43009.450294</td>
      <td>77307.962960</td>
      <td>56230.582698</td>
      <td>56230.582698</td>
      <td>3551.457755</td>
      <td>3551.457755</td>
      <td>3551.457755</td>
      <td>3551.457755</td>
      <td>3551.457755</td>
      <td>3551.457755</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>59782.040452</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>480</th>
      <td>2018-01-02</td>
      <td>10430.753220</td>
      <td>-10645.820107</td>
      <td>20038.001128</td>
      <td>10287.038125</td>
      <td>10556.745840</td>
      <td>-5814.639079</td>
      <td>-5814.639079</td>
      <td>-5814.639079</td>
      <td>-5814.639079</td>
      <td>-5814.639079</td>
      <td>-5814.639079</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4616.114140</td>
    </tr>
    <tr>
      <th>481</th>
      <td>2018-01-03</td>
      <td>10417.686680</td>
      <td>-12131.618633</td>
      <td>21312.023151</td>
      <td>10273.332005</td>
      <td>10544.184093</td>
      <td>-5725.854616</td>
      <td>-5725.854616</td>
      <td>-5725.854616</td>
      <td>-5725.854616</td>
      <td>-5725.854616</td>
      <td>-5725.854616</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4691.832063</td>
    </tr>
    <tr>
      <th>482</th>
      <td>2018-01-04</td>
      <td>10404.620140</td>
      <td>-11264.733448</td>
      <td>21481.058839</td>
      <td>10259.615204</td>
      <td>10531.622345</td>
      <td>-5640.534387</td>
      <td>-5640.534387</td>
      <td>-5640.534387</td>
      <td>-5640.534387</td>
      <td>-5640.534387</td>
      <td>-5640.534387</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4764.085753</td>
    </tr>
    <tr>
      <th>483</th>
      <td>2018-01-05</td>
      <td>10391.553601</td>
      <td>-11293.427706</td>
      <td>21583.702828</td>
      <td>10245.910236</td>
      <td>10519.060598</td>
      <td>-5560.875533</td>
      <td>-5560.875533</td>
      <td>-5560.875533</td>
      <td>-5560.875533</td>
      <td>-5560.875533</td>
      <td>-5560.875533</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4830.678068</td>
    </tr>
    <tr>
      <th>484</th>
      <td>2018-01-06</td>
      <td>10378.487061</td>
      <td>-10571.821161</td>
      <td>21827.517378</td>
      <td>10232.514272</td>
      <td>10506.498851</td>
      <td>-5488.665623</td>
      <td>-5488.665623</td>
      <td>-5488.665623</td>
      <td>-5488.665623</td>
      <td>-5488.665623</td>
      <td>-5488.665623</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4889.821439</td>
    </tr>
    <tr>
      <th>485</th>
      <td>2018-01-07</td>
      <td>10365.420522</td>
      <td>-11213.789750</td>
      <td>21737.667858</td>
      <td>10218.899641</td>
      <td>10493.937103</td>
      <td>-5425.240870</td>
      <td>-5425.240870</td>
      <td>-5425.240870</td>
      <td>-5425.240870</td>
      <td>-5425.240870</td>
      <td>-5425.240870</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4940.179652</td>
    </tr>
    <tr>
      <th>486</th>
      <td>2018-01-08</td>
      <td>10352.353982</td>
      <td>-11068.421737</td>
      <td>22756.628202</td>
      <td>10205.056042</td>
      <td>10481.449293</td>
      <td>-5371.460788</td>
      <td>-5371.460788</td>
      <td>-5371.460788</td>
      <td>-5371.460788</td>
      <td>-5371.460788</td>
      <td>-5371.460788</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4980.893194</td>
    </tr>
    <tr>
      <th>487</th>
      <td>2018-01-09</td>
      <td>10339.287442</td>
      <td>-11751.596928</td>
      <td>22353.659111</td>
      <td>10191.219798</td>
      <td>10469.065920</td>
      <td>-5327.699997</td>
      <td>-5327.699997</td>
      <td>-5327.699997</td>
      <td>-5327.699997</td>
      <td>-5327.699997</td>
      <td>-5327.699997</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5011.587446</td>
    </tr>
    <tr>
      <th>488</th>
      <td>2018-01-10</td>
      <td>10326.220903</td>
      <td>-12214.265224</td>
      <td>21555.904799</td>
      <td>10177.503749</td>
      <td>10456.812418</td>
      <td>-5293.857323</td>
      <td>-5293.857323</td>
      <td>-5293.857323</td>
      <td>-5293.857323</td>
      <td>-5293.857323</td>
      <td>-5293.857323</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5032.363580</td>
    </tr>
    <tr>
      <th>489</th>
      <td>2018-01-11</td>
      <td>10313.154363</td>
      <td>-13379.641545</td>
      <td>21442.105207</td>
      <td>10163.873381</td>
      <td>10444.834064</td>
      <td>-5269.381789</td>
      <td>-5269.381789</td>
      <td>-5269.381789</td>
      <td>-5269.381789</td>
      <td>-5269.381789</td>
      <td>-5269.381789</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5043.772575</td>
    </tr>
    <tr>
      <th>490</th>
      <td>2018-01-12</td>
      <td>10300.087824</td>
      <td>-11407.652737</td>
      <td>22014.507343</td>
      <td>10150.269457</td>
      <td>10432.577518</td>
      <td>-5253.314515</td>
      <td>-5253.314515</td>
      <td>-5253.314515</td>
      <td>-5253.314515</td>
      <td>-5253.314515</td>
      <td>-5253.314515</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5046.773309</td>
    </tr>
    <tr>
      <th>491</th>
      <td>2018-01-13</td>
      <td>10287.021284</td>
      <td>-11767.060141</td>
      <td>23105.051714</td>
      <td>10136.676775</td>
      <td>10420.474065</td>
      <td>-5244.345070</td>
      <td>-5244.345070</td>
      <td>-5244.345070</td>
      <td>-5244.345070</td>
      <td>-5244.345070</td>
      <td>-5244.345070</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5042.676214</td>
    </tr>
    <tr>
      <th>492</th>
      <td>2018-01-14</td>
      <td>10273.954744</td>
      <td>-12453.383825</td>
      <td>22490.477042</td>
      <td>10122.988290</td>
      <td>10408.031781</td>
      <td>-5240.880304</td>
      <td>-5240.880304</td>
      <td>-5240.880304</td>
      <td>-5240.880304</td>
      <td>-5240.880304</td>
      <td>-5240.880304</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5033.074441</td>
    </tr>
    <tr>
      <th>493</th>
      <td>2018-01-15</td>
      <td>10260.888205</td>
      <td>-11792.410668</td>
      <td>21383.620828</td>
      <td>10109.359927</td>
      <td>10395.589498</td>
      <td>-5241.123306</td>
      <td>-5241.123306</td>
      <td>-5241.123306</td>
      <td>-5241.123306</td>
      <td>-5241.123306</td>
      <td>-5241.123306</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5019.764899</td>
    </tr>
    <tr>
      <th>494</th>
      <td>2018-01-16</td>
      <td>10247.821665</td>
      <td>-10884.794995</td>
      <td>21807.204144</td>
      <td>10095.446589</td>
      <td>10383.147214</td>
      <td>-5243.159787</td>
      <td>-5243.159787</td>
      <td>-5243.159787</td>
      <td>-5243.159787</td>
      <td>-5243.159787</td>
      <td>-5243.159787</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5004.661878</td>
    </tr>
    <tr>
      <th>495</th>
      <td>2018-01-17</td>
      <td>10234.755126</td>
      <td>-11117.490200</td>
      <td>21908.112254</td>
      <td>10081.328118</td>
      <td>10370.704930</td>
      <td>-5245.048924</td>
      <td>-5245.048924</td>
      <td>-5245.048924</td>
      <td>-5245.048924</td>
      <td>-5245.048924</td>
      <td>-5245.048924</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4989.706201</td>
    </tr>
    <tr>
      <th>496</th>
      <td>2018-01-18</td>
      <td>10221.688586</td>
      <td>-11471.233652</td>
      <td>22612.102358</td>
      <td>10067.579986</td>
      <td>10358.232019</td>
      <td>-5244.915571</td>
      <td>-5244.915571</td>
      <td>-5244.915571</td>
      <td>-5244.915571</td>
      <td>-5244.915571</td>
      <td>-5244.915571</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4976.773015</td>
    </tr>
    <tr>
      <th>497</th>
      <td>2018-01-19</td>
      <td>10208.622046</td>
      <td>-12616.078056</td>
      <td>22604.293475</td>
      <td>10053.863185</td>
      <td>10345.699704</td>
      <td>-5241.040633</td>
      <td>-5241.040633</td>
      <td>-5241.040633</td>
      <td>-5241.040633</td>
      <td>-5241.040633</td>
      <td>-5241.040633</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4967.581413</td>
    </tr>
    <tr>
      <th>498</th>
      <td>2018-01-20</td>
      <td>10195.555507</td>
      <td>-11085.109200</td>
      <td>21862.639163</td>
      <td>10040.146384</td>
      <td>10333.148577</td>
      <td>-5231.946498</td>
      <td>-5231.946498</td>
      <td>-5231.946498</td>
      <td>-5231.946498</td>
      <td>-5231.946498</td>
      <td>-5231.946498</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4963.609009</td>
    </tr>
    <tr>
      <th>499</th>
      <td>2018-01-21</td>
      <td>10182.488967</td>
      <td>-12116.756382</td>
      <td>22124.561839</td>
      <td>10026.429583</td>
      <td>10320.597449</td>
      <td>-5216.474494</td>
      <td>-5216.474494</td>
      <td>-5216.474494</td>
      <td>-5216.474494</td>
      <td>-5216.474494</td>
      <td>-5216.474494</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4966.014473</td>
    </tr>
    <tr>
      <th>500</th>
      <td>2018-01-22</td>
      <td>10169.422428</td>
      <td>-11799.236660</td>
      <td>22128.247318</td>
      <td>10012.712782</td>
      <td>10308.046322</td>
      <td>-5193.851637</td>
      <td>-5193.851637</td>
      <td>-5193.851637</td>
      <td>-5193.851637</td>
      <td>-5193.851637</td>
      <td>-5193.851637</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4975.570791</td>
    </tr>
    <tr>
      <th>501</th>
      <td>2018-01-23</td>
      <td>10156.355888</td>
      <td>-11397.718675</td>
      <td>21488.804694</td>
      <td>9998.995980</td>
      <td>10295.688169</td>
      <td>-5163.744193</td>
      <td>-5163.744193</td>
      <td>-5163.744193</td>
      <td>-5163.744193</td>
      <td>-5163.744193</td>
      <td>-5163.744193</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4992.611695</td>
    </tr>
    <tr>
      <th>502</th>
      <td>2018-01-24</td>
      <td>10143.289348</td>
      <td>-12170.143585</td>
      <td>21137.408443</td>
      <td>9985.289993</td>
      <td>10283.354063</td>
      <td>-5126.296039</td>
      <td>-5126.296039</td>
      <td>-5126.296039</td>
      <td>-5126.296039</td>
      <td>-5126.296039</td>
      <td>-5126.296039</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5016.993309</td>
    </tr>
    <tr>
      <th>503</th>
      <td>2018-01-25</td>
      <td>10130.222809</td>
      <td>-11855.103144</td>
      <td>21615.603916</td>
      <td>9971.447744</td>
      <td>10271.019957</td>
      <td>-5082.150230</td>
      <td>-5082.150230</td>
      <td>-5082.150230</td>
      <td>-5082.150230</td>
      <td>-5082.150230</td>
      <td>-5082.150230</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5048.072579</td>
    </tr>
    <tr>
      <th>504</th>
      <td>2018-01-26</td>
      <td>10117.156269</td>
      <td>-12025.376518</td>
      <td>22220.684386</td>
      <td>9957.493001</td>
      <td>10258.685851</td>
      <td>-5032.452727</td>
      <td>-5032.452727</td>
      <td>-5032.452727</td>
      <td>-5032.452727</td>
      <td>-5032.452727</td>
      <td>-5032.452727</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5084.703542</td>
    </tr>
    <tr>
      <th>505</th>
      <td>2018-01-27</td>
      <td>10104.089730</td>
      <td>-12326.781502</td>
      <td>21628.736366</td>
      <td>9943.939751</td>
      <td>10246.351744</td>
      <td>-4978.837801</td>
      <td>-4978.837801</td>
      <td>-4978.837801</td>
      <td>-4978.837801</td>
      <td>-4978.837801</td>
      <td>-4978.837801</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5125.251929</td>
    </tr>
    <tr>
      <th>506</th>
      <td>2018-01-28</td>
      <td>10091.023190</td>
      <td>-12000.100061</td>
      <td>22722.886587</td>
      <td>9930.400801</td>
      <td>10234.017638</td>
      <td>-4923.395183</td>
      <td>-4923.395183</td>
      <td>-4923.395183</td>
      <td>-4923.395183</td>
      <td>-4923.395183</td>
      <td>-4923.395183</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5167.628007</td>
    </tr>
    <tr>
      <th>507</th>
      <td>2018-01-29</td>
      <td>10077.956651</td>
      <td>-11021.460045</td>
      <td>21882.372752</td>
      <td>9916.765027</td>
      <td>10221.727326</td>
      <td>-4868.619657</td>
      <td>-4868.619657</td>
      <td>-4868.619657</td>
      <td>-4868.619657</td>
      <td>-4868.619657</td>
      <td>-4868.619657</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5209.336993</td>
    </tr>
    <tr>
      <th>508</th>
      <td>2018-01-30</td>
      <td>10064.890111</td>
      <td>-11496.619265</td>
      <td>20772.074491</td>
      <td>9903.067605</td>
      <td>10209.526120</td>
      <td>-4817.344316</td>
      <td>-4817.344316</td>
      <td>-4817.344316</td>
      <td>-4817.344316</td>
      <td>-4817.344316</td>
      <td>-4817.344316</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5247.545795</td>
    </tr>
    <tr>
      <th>509</th>
      <td>2018-01-31</td>
      <td>10051.823571</td>
      <td>-13360.948215</td>
      <td>21954.650132</td>
      <td>9889.370183</td>
      <td>10197.222692</td>
      <td>-4772.659269</td>
      <td>-4772.659269</td>
      <td>-4772.659269</td>
      <td>-4772.659269</td>
      <td>-4772.659269</td>
      <td>-4772.659269</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5279.164302</td>
    </tr>
  </tbody>
</table>

```python
figure = m.plot(forecast, xlabel='Date', ylabel='Crime Rate')
```

![image](https://user-images.githubusercontent.com/39285147/180626434-50c9ad80-89f1-41b7-8f09-0b81df037201.png)

시각화 자료에서 볼 수 있듯이 데이터에 포함된 2017년 이후의 연도 또한 Prophet을 통하여 표현이 가능하다. <span style="color: blue"> As can be seen from the visualization data, the years after 2017 included in the data can also be expressed through Prophet. </span>


```python
# 예측된 추세가 어떤 모양일지 도출 Determining what the predicted trend will look like
figure3 = m.plot_components(forecast)
```

![image](https://user-images.githubusercontent.com/39285147/180626451-4193c24f-4667-483b-867e-934386363c79.png)

시카고와 같은 경우 그래프에서 7월달(여름)까지 범죄율이 상승하다가, 그 이후로 겨울을 맞아 날씨가 추워지면서 범죄율이 하락하는 현상을 관찰해볼 수 있다. <span style="color: blue"> In the case of Chicago, the graph shows that the crime rate rises until July (summer), and then the crime rate decreases as the weather gets colder in winter. </span>

# PART 2: Avocado Market
![image](https://user-images.githubusercontent.com/39285147/180627180-230065b5-cac5-4905-9275-9a3b8c9c0201.png)

## Description
페이스북 Prophet을 사용해 미래 물가를 예측한다. <span style="color: blue">

## Observing the dataset
**Some relevant columns in the dataset**:
- Date - The date of the observation
- AveragePrice - the average price of a single avocado
- type - conventional or organic
- year - the year
- Region - the city or region of the observation
- Total Volume - Total number of avocados sold
- 4046 - Total number of avocados with PLU 4046 sold
- 4225 - Total number of avocados with PLU 4225 sold
- 4770 - Total number of avocados with PLU 4770 sold

## Loading the dataset

```python
# import libraries 
import pandas as pd # Import Pandas for data manipulation using dataframes
import numpy as np # Import Numpy for data statistical analysis 
import matplotlib.pyplot as plt # Import matplotlib for data visualisation
import random
import seaborn as sns
from fbprophet import Prophet

```

```python
avocado_df = pd.read_csv('avocado.csv')

```

```python
# 날짜별 아보카도 가격분포 Avocado price distribution by date
avocado_df = avocado_df.sort_values("Date") # 시간 순으로 정렬 order by time
plt.figure(figsize=(10,10))
plt.plot(avocado_df['Date'], avocado_df['AveragePrice'])
```

![image](https://user-images.githubusercontent.com/39285147/180627643-4643c6bd-53b8-4c99-b2b3-72be82c8e849.png)


```python
# 지역별 아보카도 가격분포 Avocado Price Distribution by Region
plt.figure(figsize=[25,12])
sns.countplot(x = 'region', data = avocado_df)
plt.xticks(rotation = 45)

```

![image](https://user-images.githubusercontent.com/39285147/180627663-1f2a671d-918e-407c-ae38-7324e92e2f50.png)


```python
# 연도별 아보카도 가격분포 Avocado Price Distribution by Year
plt.figure(figsize=[25,12])
sns.countplot(x = 'year', data = avocado_df)
plt.xticks(rotation = 45)
```

![image](https://user-images.githubusercontent.com/39285147/180627690-5098e10e-886c-4557-948e-f31b670aedac.png)


## Prediction

```python
avocado_prophet_df = avocado_df[['Date', 'AveragePrice']] # Prophet에 필요한 열만 추출 Extracting only the columns needed by Prophet
avocado_prophet_df = avocado_prophet_df.rename(columns={'Date':'ds', 'AveragePrice':'y'}) # Prophet 열이름 사전설정 Prophet column name presets

avocado_prophet_df
```

![image](https://user-images.githubusercontent.com/39285147/180627737-38939649-e27b-4405-8db4-f6eef7244366.png)


```python
# Applying the Prophet
m = Prophet()
m.fit(avocado_prophet_df)

# Forcasting into the future
future = m.make_future_dataframe(periods=365) # 미래 1년 동안의 아보카도 가격 예측 Avocado Price Prediction for the Future Year
forecast = m.predict(future)

figure = m.plot(forecast, xlabel='Date', ylabel='Price')
```


![image](https://user-images.githubusercontent.com/39285147/180627774-0e9170c5-caf9-4068-be02-cdb9c81f6bee.png)

```python
figure3 = m.plot_components(forecast)
```

![image](https://user-images.githubusercontent.com/39285147/180627779-8ad49295-3efa-4aa8-ba02-8587bb0ffdc1.png)

