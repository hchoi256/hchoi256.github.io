---
layout: single
title: "DBMS: File Organization and Indexing"
categories: DB
tag: [Database, Files, Indexing]
toc: true
toc_sticky: true
toc_label: "ì­ŒìŠ¤log"
#author_profile: false
header:
    teaser: /assets/images/posts/db.png
sidebar:
    nav: "docs"
---

# INTRO ğŸ™Œ
ì €ë²ˆ ì‹œê°„ì—ëŠ” Diskì™€ File ëŒ€í•˜ì—¬ ì•Œì•„ë³´ì•˜ë‹¤.

ì´ë²ˆ ì‹œê°„ì—ëŠ” **File Organiaztion**ê³¼ **Indexing**ì— ê°œë…ì— ëŒ€í•´ ì•Œì•„ë³´ì.

# ì§ê´€ ğŸ‘€
![image](https://user-images.githubusercontent.com/39285147/195951022-862b5f28-a4c2-46e7-9ca2-d99a30e72306.png)

Frequent operations
- scan (ëª¨ë“  tuples íƒìƒ‰)
- sort
- equality/range search
- insert/delete tuples
- search by person name
- search by age, sal, or (age, sal)

**File organizations**ì™€ **indexes**ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ëŸ¬í•œ ì²˜ë¦¬ì— ëŒ€í•œ ì†ë„ë¥¼ ë†’ì¼ ìˆ˜ ìˆë‹¤.

# File Organizations ğŸ§¿
## Hash
nê°œì˜ buckets; ê° bucketì€ pagesë“¤ì˜ ì—°ê²° ë¦¬ìŠ¤íŠ¸ë¡œ, ê° tupleì„ í•˜ë‚˜ì˜ bucketìœ¼ë¡œ hashí•œë‹¤.

ë‹¤ë¥´ê²Œ ë§í•˜ë©´, hash íŒŒì¼ì„ êµ¬ì„±í•˜ëŠ” í˜ì´ì§€ë“¤ì€ bucket ë‹¨ìœ„ë¡œ ë¬¶ì¸ë‹¤. 

bucket ë²ˆí˜¸ê°€ í•˜ë‚˜ ì£¼ì–´ì§€ë©´ ê·¸ bucketì— í•´ë‹¹í•˜ëŠ” ê¸°ë³¸ í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ìˆëŠ” ê²ƒì´ hash íŒŒì¼ êµ¬ì¡°

ê°€ë ¹, íŒŒì¼ì´ name í•„ë“œì— ëŒ€í•´ì„œ hashê°€ ë˜ì–´ìˆëŠ” ê²½ìš°ì— â€˜Joeë¼ëŠ” ì´ë¦„ì˜ í•™ìƒ ë ˆì½”ë“œë¥¼ ì°¾ì•„ë¼â€™

## Sorted
![image](https://user-images.githubusercontent.com/39285147/195950275-8a2c1d58-09e4-415b-ad1a-6be47f6461c3.png)

í˜ì´ì§€ ë‚´ì˜ ë°ì´í„°ê°€ ì •ë ¬ë˜ì–´ ìˆëŠ” íŒŒì¼êµ¬ì¡°ë¥¼ ë§í•œë‹¤.

í•˜ë‚˜ì˜ ì†ì„± í˜¹ì€ ì—¬ëŸ¬ ê°œì˜ ì†ì„± ì¡°í•© ('search keys' or just 'keys')

> Entity set or tableì— ì¡´ì¬í•˜ëŠ” keyì™€ ë‹¤ë¦„

## B+
![image](https://user-images.githubusercontent.com/39285147/195950454-9e2160b2-40fd-405d-998d-7d3d96db4450.png)

Sorted file with a lot of pointers on top to direct search

# Index ğŸ†
ì¸ë±ìŠ¤ë¼ëŠ” ìë£Œ êµ¬ì¡°ë¥¼ í†µí•´ ì›í•˜ëŠ” ë ˆì½”ë“œ ì •ë³´ë¥¼ ë¹ ë¥´ê²Œ ê²€ìƒ‰ ê°€ëŠ¥

ì´ëŸ¬í•œ ì¸ë±ìŠ¤ ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ëŠ” í•„ë“œ = Search keyë¼ í•œë‹¤.

## 1. Clustered vs Unclustered indexes
### Clustered
- í…Œì´ë¸”ë‹¹ ì˜¤ì§ í•œê°œ
- ë°ì´í„°ê°€ í…Œì´ë¸”ì— ë¬¼ë¦¬ì ìœ¼ë¡œ ì €ì¥ ë˜ëŠ” ìˆœì„œ
    - ê°€ë ¹, idê°€ í´ëŸ¬ìŠ¤í„° í˜• ì¸ë±ìŠ¤ --> id ê°’ ê¸°ì¤€ ì •ë ¬
- ë³„ë„ì˜ ê³µê°„ì„ í•„ìš” X

ì–¸ì œ ì‚¬ìš©?
- ë°ì´í„°ê°€ ìì£¼ ì—…ë°ì´íŠ¸ ë˜ì§€ ì•ŠëŠ” ê²½ìš°
- í•­ìƒ ì •ë ¬ ëœ ë°©ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë°˜í™˜í•´ì•¼í•˜ëŠ” ê²½ìš°
- ì½ê¸° ì‘ì—…ì´ ì›”ë“±íˆ ë§ì€ ê²½ìš°, ì´ë•Œ ë§¤ìš° ë¹ ë¥´ë‹¤.

### Non-Clustered
- í…Œì´ë¸” ë‹¹ ì—¬ëŸ¬ê°œì˜ ì¸ë±ìŠ¤ 
- êµ°ì§‘í™” ë˜ì–´ìˆì§€ ì•Šì€ ì¸ë±ìŠ¤ íƒ€ì…
- ë¬¼ë¦¬ì ì¸ ìˆœì„œì— ë”°ë¼ ë°ì´í„°ë¥¼ ì •ë ¬ X --> ìˆœì„œëŒ€ë¡œ ì •ë ¬ X
- ì €ì¥ë˜ëŠ” ë³„ë„ì˜ ê³µê°„(ì•½ 10%)ì´ í•„ìš”

ì–¸ì œ ì‚¬ìš©?
- whereì ˆì´ë‚˜ Joinì ˆê³¼ ê°™ì´ ì¡°ê±´ë¬¸ í™œìš© í…Œì´ë¸” í•„í„°ë§ í•  ë•Œ
- ë°ì´í„°ê°€ ìì£¼ ì—…ë°ì´íŠ¸ ë  ë•Œ
- íŠ¹ì • ì»¬ëŸ¼ì´ ì¿¼ë¦¬ì—ì„œ ìì£¼ì‚¬ìš© ë  ë•Œ

## 2. Primary vs secondary indexes
Primary indexes
- ì •ë ¬ë˜ì–´ìˆëŠ” íŒŒì¼ì— ëŒ€í•œ ê°„ë‹¨í•œ ì¸ë±ìŠ¤

Secondary indexes
- ì •ë ¬ë˜ì–´ìˆì§€ ì•Šì€ íŒŒì¼ì— ëŒ€í•œ ì¸ë±ìŠ¤

## 3. B+ Tree Index
ê°€ì¥ ë„ë¦¬ ì“°ì´ëŠ”, íŠ¸ë¦¬ êµ¬ì¡° ì¸ë±ìŠ¤

### SEARCH
![image](https://user-images.githubusercontent.com/39285147/196806182-0c86c587-ff83-4a14-88a6-21f94e82c4e6.png)

Insert/delete ì²˜ë¦¬ëŠ” $$log_F(N)$$ì˜ ë¹„ìš©ì´ ë°œìƒí•œë‹¤ (F = fanout, N = # leaf pages/records/tuples)

Treeë¥¼ **height-balanced**í•˜ê²Œ ìœ ì§€í•˜ë©´, equality and range-searchesê°€ íš¨ìœ¨ì ìœ¼ë¡œ ë°œìƒí•œë‹¤.

ì´ë¥¼ ìœ„í•´, ìµœì†Œ 50% ë¹„ìœ¨ë¡œ ê³µê°„ í• ë‹¹í•œë‹¤ (root ì œì™¸). 
- ê° ë…¸ë“œ entry ê°œìˆ˜: $$d <=  m  <= 2d$$

ì—¬ê¸°ì„œ dëŠ” íŠ¸ë¦¬ orderë¥¼ ì˜ë¯¸í•œë‹¤ (*ì•„ë˜ ì˜ˆì‹œ ì°¸ì¡°*).

![image](https://user-images.githubusercontent.com/39285147/195945981-485264ec-4ad6-4f94-883a-b07cf341509f.png)

ìƒê¸° ì˜ˆì œì—ì„œ, d=2ë¼ëŠ” ë§ì€ ê° entry ê°œìˆ˜ê°€ 4ê°œì¸ ê° sequence setì„ 2ê°œ, ì¦‰ ì ˆë°˜ì„ ì±„ìš°ëŠ” ê²ƒì´ë‹¤.

#### B+ Trees SEARCH ì‹¤ìŠµ
**ì˜ˆì œ 1.** Typical order: 100 | Typical fill-factor: 67%.
$$Average Fanout = 100 + 100 * 33/100 = 133$$

Typical capacities:
$$Height 4: 133^4 = 312,900,700 records$$

$$Height 3: 133^3 = 2,352,637 records$$

Can often hold top levels in buffer pool:
$$Level 1 = 1 page  = 8 Kbytes$$

$$Level 2 = 133 pages = 1 Mbyte$$

$$Level 3 = 17,689 pages = 133 MBytes$$

**ì˜ˆì œ 2.** Assume a file which has 950 thousands (that is, 950000) records. Assume also that we are indexing this file using a B+ tree. In this particular B+ tree, the average page has an occupancy of 100 pointers (that is, the tree's average branching factor is 100). Assume further that the amount of memory set aside for storing the index is 150 blocks, and that all 950000 records of the above file reside on disk.

Assume no duplicate search key exists, given a search key K, compute the minimal number of disk I/O needed to retrieve the record with that search key. Explain your answer.

![image](https://user-images.githubusercontent.com/39285147/195949837-1bcfb5b1-891b-4fa4-b03c-030eb941f5d3.png)

ë‹¤ìŒ leafë¡œ ë»—ì–´ê°€ëŠ” pointer ê°œìˆ˜: 100ê°œ | ì €ì¥ ê°€ëŠ¥í•œ memory block ê°œìˆ˜: 150ê°œ

ë”°ë¼ì„œ, 950,000ê°œì˜ blockì„ ë‹´ê¸° ìœ„í•´ì„œ ìµœì†Œ 3ê°œ ë†’ì´ì˜ íŠ¸ë¦¬ê°€ í•„ìš”í•˜ë‹¤; $$100^3 > 950,000$$.

íŠ¹ì • block íƒìƒ‰ì„ ìœ„í•´ í•„ìš”í•œ ê°€ì¥ ìµœì†Œ disk I/O ê°œìˆ˜ëŠ” íŠ¸ë¦¬ level 2ê¹Œì§€ ì´ block ê°œìˆ˜ê°€ 100ê°œì´ë¯€ë¡œ, ê·¸ 100ê°œ ì „ë¶€ë¥¼ memoryì— ì €ì¥í•˜ê³  level 3ì—ì„œ ìš´ì¢‹ê²Œ ì”ì—¬ 50ê°œì˜ memory ìš©ëŸ‰ì„ ì´ˆê³¼í•˜ê¸° ì „ì— ì°¾ì•„ë‚´ëŠ” ì‹œë‚˜ë¦¬ì˜¤ì¼ ê²ƒì´ë‹¤.

ë”°ë¼ì„œ, ê°€ì¥ ìµœì†Œ disk I/O ê°œìˆ˜ëŠ” 1ê°œì´ë‹¤.

> B+ Tree íƒìƒ‰ ë¬¸ì œ ì¤‘ê°„ê³ ì‚¬ â˜…

### INSERT
![image](https://user-images.githubusercontent.com/39285147/195950661-1e940fc0-2f1b-43b3-865e-5e41f173460d.png)

7ê³¼ 14 ì‚¬ì´ì— 8ì„ ë„£ìœ¼ë ¤ëŠ”ë° ê³µê°„ì´ ì—†ëŠ” ëª¨ìŠµì´ë‹¤; ê³µê°„ ìˆìœ¼ë©´ end.

![image](https://user-images.githubusercontent.com/39285147/195950730-a665adfa-d3e2-4bdc-89e3-d346de58c550.png)

ë•Œë¬¸ì—, ìƒê¸° ê·¸ë¦¼ì²˜ëŸ¼ í•´ë‹¹ leafë¥¼ splití•˜ê³ , ìˆ«ì 5ë¥¼ rootë¡œ ë³µì‚¬í•˜ì—¬ ëŠì–´ì§„ pointerë¥¼ ë³µêµ¬í•œë‹¤.

![image](https://user-images.githubusercontent.com/39285147/195950840-c052a5ac-bdca-4125-854a-c9cba60f470b.png)

rootê°€ 4ê°œ ì´ìƒì˜ entryë¥¼ í¬í•¨í•˜ê³  ìˆê¸° ë•Œë¬¸ì—, ì¤‘ê°„ ìˆ«ìì¸ 17ì„ ìƒˆë¡œìš´ rootë¡œ ì˜¬ë¦°ë‹¤.

![image](https://user-images.githubusercontent.com/39285147/195950941-682bdce6-c873-43bc-b2c6-ce70fe33bcea.png)

B+ TREEì—ì„œ INSERTë¥¼ í•œ ìµœì¢… ëª¨ìŠµì´ë‹¤.

> INSERT ë¬¸ì œ ì¤‘ê°„ê³ ì‚¬ â˜…

### DELETE
![image](https://user-images.githubusercontent.com/39285147/196808678-dc8ecd0b-1aa3-4591-9110-e7a9d3d43333.png)

![image](https://user-images.githubusercontent.com/39285147/196808846-2ca76f1a-b50f-4e58-8b5e-8f5bd7f8eb82.png)

****
# Reference 
[Database Management Systems by Raghu Ramakrishnan and Johannes Gehrke](https://pages.cs.wisc.edu/~dbbook/)

[Relational Operators](https://www.javatpoint.com/dbms-relational-algebra)