---
layout: single
title: "DBMS: Relational Algebra"
categories: DB
tag: [Database, Relational Algebra]
toc: true
toc_sticky: true
toc_label: "ì­ŒìŠ¤log"
#author_profile: false
header:
    teaser: /assets/images/posts/db.png
sidebar:
    nav: "docs"
---

# INTRO ğŸ™Œ
ì €ë²ˆ ì‹œê°„ì—ëŠ” Relational Algebra Operations ì— ëŒ€í•˜ì—¬ ì•Œì•„ë³´ì•˜ë‹¤.

ì´ë²ˆ ì‹œê°„ì—ëŠ” **Relational Algebra**ê°€ ë¬´ì—‡ì¸ì§€ ì•Œì•„ë³´ì.

****
# RAë€?
- ë‹¤ì„¯ ê°œì˜ ê¸°ë³¸ ì—°ì‚°ì; ê¸°ë³¸ ì—°ì‚°ìë¡œë¶€í„° íŒŒìƒë¬¼ å¤š
- ì¿¼ë¦¬ ìƒì„±ì„ ìœ„í•´ ì—°ì‚°ì ì¡°í•©
    - **RA expressions**, ì£¼ë¡œ íŠ¸ë¦¬ í˜•íƒœ

****
# Complex Expressions (ë³µì¡í•œ í‘œí˜„ì‹)
- RAëŠ” ëŒ€ìˆ˜í•™ê³¼ ë¹„ìŠ·í•˜ê²Œ ë™ì‘
    - ê°€ë ¹ $$(x + 4)*(y - 3)$$
- 3ê°€ì§€ notations (just as in arithmetic):
    - 1. Sequences of assignment statements
    - 2. Expressions with several operators
    - 3. Expression trees

## 1) Sequences of Assignment
Theta-Join: $$R3\ :=\ R1\ JOIN_C\ R2$$

$$ R4:= R1 * R2 \\ R3 :=\ SELECT_C\ (R1 * R2)$$

- ì„ì‹œ relation ì´ë¦„ ìƒì„± $$R4$$
- Renaming can be implied by giving relations a list of attributes

## 2) Expressions with Several Operators
theta-join: $$R3\ :=\ R1\ JOIN_C\ R2$$

$$R3\ :=\ SELECT_C\ (R1 * R2)$$

- ê´€ê³„ ì—°ì‚°ì(relational operators) ìš°ì„  ìˆœìœ„:
    1. Unary operators (i.e., select, project, rename)
    2. Products and joins
    3. Intersection
    4. Union and set difference

> ê´„í˜¸() ì‚¬ìš©í•˜ì—¬ í•­ìƒ ìš°ì„  ìˆœìœ„ë¥¼ ë³€ê²½ ê°€ëŠ¥

## 3) Expression Trees
- ê°€ì§€(Leaves) = operands
    - ê´€ê³„ ë³€ìˆ˜ (variables standing for relations)
    - íŠ¹ì • ê´€ê³„ (particular, constant relations)
- Interior nodes = operators
    - applied to their child or children.

## ì‘ìš©
***"Maple St." ì´ë¦„ì„ ê°€ì¡Œê±°ë‚˜ "Bud" ê°€ê²©ì´ \$3 ë³´ë‹¤ ì‘ì€ ëª¨ë“  bars ì´ë¦„ ê°€ì ¸ì˜¤ê¸°***

$$Bars(name, addr)$$

$$Sells(bar, beer, price)$$ 

![image](https://user-images.githubusercontent.com/39285147/201670239-1c4b8c51-a671-4591-88c0-899c992773b4.png)

***ì„œë¡œ ë‹¤ë¥¸ ë‘ ê°œì˜ ë§¥ì£¼ë¥¼ ê°™ì€ ê°€ê²©ì— íŒŒëŠ” bars ê°€ì ¸ì˜¤ê¸°***

$$Sells(bar, beer, price)$$ 

![image](https://user-images.githubusercontent.com/39285147/201671137-ebac22e8-8d70-443c-89e7-0e8a6bfa7b6b.png)

**Renaming**ì„ í†µí•´ Sellsì˜ ë³µì‚¬ë³¸ $$S(bar, beer1, price)$$ì„ ì •ì˜í•˜ëŠ” ëª¨ìŠµì´ë‹¤.
- bar, price ì—´ ê¸°ì¤€ìœ¼ë¡œ ìì—°ì¡°ì¸ --> beer, beer1ë§Œ cross-product ì§„í–‰ í›„ ì¤‘ë³µ ì œê±°

ì´í›„, *Sells*ê³¼ *S*ì„ **Natural Join**ìœ¼ë¡œ ë¬¶ì–´, ì£¼ì–´ì§„ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” $$quadruples(bar, beer, beer1, price)$$ë¥¼ ìƒì„±í•œë‹¤.

****
# Complex Queries (ë³µì¡í•œ ì¿¼ë¦¬)
        Product ( pid, name,  price, category, maker-cid)
        Purchase (buyer-ssn,  seller-ssn,  store,  pid)
        Company (cid, name, stock price, country)
        Person(ssn, name, phone number, city)

- *Purchase*
    - buyer-ssn, seller-ssn: foreign keys in Person
    - pid: foreign key in Product; 
- *Product*
    - maker-cid: a foreign key in Company

í•˜ê¸° ì˜ˆì‹œë“¤ì„ í†µí•´ ì‘ìš© ì´í•´ë¥¼ ë„ëª¨í•˜ê¸°ë¥¼ ë°”ë€ë‹¤.

Ex #0: ***Find phone numbers of people who bought gizmos from Fred.***

> ![image](https://user-images.githubusercontent.com/39285147/201672020-92a15eec-b26c-46b3-8696-7d611790a9fe.png)

Ex #1: Find people who bought telephony products.

Ex #2: Find names of people who bought American products 

Ex #3: Find telephony products that somebody bought

Ex #4: Find names of people who bought American products and did not buy French products

Ex #5: Find names of people who bought American products and they live in Champaign.
 
Ex #6: Find people who bought stuff from Joe or bought products from a company whose stock prices is more than $$50.

# Operations on Bags
- **Union**: $$\{a,b,b,c\}\ U\ \{a,b,b,b,e,f,f\}\ =\ \{a,a,b,b,b,b,b,c,e,f,f\}$$
    - add the number of occurrences
- **Difference**: $$\{a,b,b,b,c,c\}\ â€“\ \{b,c,c,c,d\}\ =\ \{a,b,b,d\}$$
    - subtract the number of occurrences
- **Intersection**: $$\{a,b,b,b,c,c\}\ \cap\ \{b,b,c,c,c,c,d\}\ =\ \{b,b,c,c\}$$
    - minimum of the two numbers of occurrences
- **Selection**: íŠ¹ì • ìš”ì†Œ ì„ íƒ; preserve the number of occurrences (ì¤‘ë³µ ì œê±°)
- **Projection**: íŠ¹ì • ìš”ì†Œ ì„ íƒ; preserve the number of occurrences (ì¤‘ë³µ í¬í•¨)
- **Cartesian product, join**: ì¤‘ë³µ í¬í•¨; no duplicate elimination

> ìƒê¸° ê°œë…ë“¤ì´ ìµìˆ™í•˜ì§€ ì•Šë‹¤ë©´
>> [ì´ì „ ê¸€](https://hchoi256.github.io/db/db8/) ì°¸ì¡°
>>
>> í˜¹ì€ Textbook ì°¸ì¡° ìš”ë§

****
# Glimpse Ahead
## Efficient Implementations of Operators
$$\sigma_{s(age >= 30 AND age <= 35)}(Employees)$$
- Method 1: scan the file, test each employee
- Method 2: use an index on age
-Which one is better ? Depends a lotâ€¦

$$Employees\ \infty\ Relatives$$
- ì´ì¤‘ ë°˜ë³µë¬¸
    - 1) Iterate over Employees, then over Relatives
    - 2) Iterate over Relatives, then over Employees
- Sort Employees, Relatives, do **merge-join*
- **hash-join*
- etc.

### MERGE-JOIN
- ì¡°íšŒì˜ ë²”ìœ„ê°€ ë§ì„ ë•Œ ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì¡°ì¸ ë°©ë²•
- ì–‘ìª½ í…Œì´ë¸”ì„ ê°ê° Access í•˜ì—¬ ê·¸ ê²°ê³¼ë¥¼ ì •ë ¬í•˜ê³ , ê·¸ ì •ë ¬í•œ ê²°ê³¼ë¥¼ ì°¨ë¡€ë¡œ Scan í•´ ë‚˜ê°€ë©´ì„œ ì—°ê²°ê³ ë¦¬ì˜ ì¡°ê±´ìœ¼ë¡œ Merge

#### ì‚¬ìš© ëª©ì 
- ì—°ê²° ê³ ë¦¬ì— ì¸ë±ìŠ¤ê°€ ì „í˜€ ì—†ëŠ” ê²½ìš°
- ëŒ€ìš©ëŸ‰ì˜ ìë£Œë¥¼ ì¡°ì¸í• ë•Œ ìœ ë¦¬í•œ ê²½ìš°
- ì¡°ì¸ ì¡°ê±´ìœ¼ë¡œ <, >, <=, >=ì™€ ê°™ì€ ë²”ìœ„ ë¹„êµ ì—°ì‚°ìê°€ ì‚¬ìš©ëœ ê²½ìš°
- ì¸ë±ìŠ¤ ì‚¬ìš©ì— ë”°ë¥¸ ëœë¤ ì•¡ì„¸ìŠ¤ì˜ ì˜¤ë²„í—¤ë“œê°€ ë§ì€ ê²½ìš°

### HASH-JOIN
![image](https://user-images.githubusercontent.com/39285147/201679781-06f42e63-5f5f-4eee-be38-1385f66711fa.png)

- ì¡°ì¸ë  ë‘ í…Œì´ë¸” ì¤‘ í•˜ë‚˜ë¥¼ í•´ì‹œ í…Œì´ë¸”ë¡œ ì„ ì •
- ì¡°ì¸ë  í…Œì´ë¸”ì˜ ì¡°ì¸ í‚¤ ê°’ì„ í•´ì‹œ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ë¹„êµí•˜ì—¬ ë§¤ì¹˜ë˜ëŠ” ê²°ê³¼ê°’ì„ ì–»ëŠ” ë°©ì‹

#### ì‚¬ìš© ëª©ì 
1. JOIN ì»¬ëŸ¼ì— ì ë‹¹í•œ ì¸ë±ìŠ¤ê°€ ì—†ì–´ NL JOINì´ ë¹„íš¨ìœ¨ì ì¼ ë•Œ
2. JOIN AccessëŸ‰ì´ ë§ì•„ Random Access ë¶€í•˜ê°€ ì‹¬í•˜ì—¬ NL JOINì´ ë¹„íš¨ìœ¨ì ì¼ ë•Œ
3. Sort Merge Joinì„ í•˜ê¸°ì—ëŠ” ë‘ í…Œì´ë¸”ì´ ë„ˆë¬´ ì»¤ Sort ë¶€í•˜ê°€ ì‹¬í•  ë•Œ
4. ìˆ˜í–‰ë¹ˆë„ê°€ ë‚®ê³  ì¿¼ë¦¬ ìˆ˜í–‰ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ëŒ€ìš©ëŸ‰ í…Œì´ë¸”ì„ JOIN í•  ë•Œ

## Optimizations
        Product ( pid, name,  price, category, maker-cid)
        Purchase (buyer-ssn,  seller-ssn,  store,  pid)
        Person(ssn, name, phone number, city)

$$\sigma_{price>100}(Product)\ \infty\ (Purchase\ \infty\ \sigma_{city=sea}Person)$$
$$(\sigma_{price>100}(Product)\ \infty\ Purchase)\ \infty\ \sigma_{city=sea}Person$$

ìƒê¸° ë‘ ê°€ì§€ ì¤‘ ì–´ë–¤ ì„ íƒì´ ë” ë‚˜ì€ ì„ íƒì¸ì§€ëŠ” ìƒí™©ì— ë”°ë¼ ê°€ë³€ì ì´ë‹¤.
- Optimizerì˜ ì—­í• ..

****
# Summary of Relational Algebra
## ì‚¬ìš© ëª©ì 
1. Operator í™œìš© ë³µì¡í•œ êµ¬í˜„ í‘œí˜„ ê°€ëŠ¥ (i.e., $$\infty\ or\ \sigma_{C}$$)
2. RA expressions ì¬í™œìš© ê°€ëŠ¥ $$\rarr$$ **ìµœì í™”**

## í•œê³„
"*transitive closure*" ê³„ì‚° ë¶ˆê°€ëŠ¥.

> **Transitive closure**
>> ![image](https://user-images.githubusercontent.com/39285147/201679157-b66b4a81-faee-4f1b-918c-3ae7b4c61663.png)
>>
>> ì–´ë–¤ ì •ì  Aì—ì„œ Cë¡œ ê°€ëŠ” ì§ì ‘ê²½ë¡œëŠ” ì—†ê³ , ìš°íšŒê²½ë¡œê°€ ìˆì„ ë•Œ A$$\rarr$$Cë¡œì˜ ê°„ì„ ì„ ì—°ê²°í•œ ê·¸ë˜í”„

![image](https://user-images.githubusercontent.com/39285147/201678637-33e63e29-bb74-434f-9e4e-54bed2054716.png)

ê°€ë ¹, ìƒê¸° í…Œì´ë¸”ì—ì„œ *Fred*ì™€ ì§ê°„ì ‘ ì¹œì¡±ì„ ì°¾ëŠ” ê²ƒì€ RA í‘œí˜„ ëŒ€ì‹ , C programì„ ì‘ì„±í•´ì•¼ í•œë‹¤.

****
# Reference 
[Database Management Systems by Raghu Ramakrishnan and Johannes Gehrke](https://pages.cs.wisc.edu/~dbbook/)

[Relational Operators](https://www.javatpoint.com/dbms-relational-algebra)