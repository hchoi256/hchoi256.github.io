---
layout: single
title: "DBMS: Query Optimization"
categories: DB
tag: [Database, Query Optimization]
toc: true
toc_sticky: true
toc_label: "ì­ŒìŠ¤log"
#author_profile: false
header:
    teaser: /assets/images/posts/db.png
sidebar:
    nav: "docs"
---

# INTRO ğŸ™Œ
ì €ë²ˆ ì‹œê°„ì—ëŠ” Evaluation of Relational Operations: Other Techniques ì— ëŒ€í•˜ì—¬ ì•Œì•„ë³´ì•˜ë‹¤.

ì´ë²ˆ ì‹œê°„ì—ëŠ” **Query Optimization**ì— ëŒ€í•´ ì•Œì•„ë³´ì.

****
# Query Optimization ì§ê´€ ğŸ‘€
![image](https://user-images.githubusercontent.com/39285147/204927988-6ad23c14-e6be-46d5-aac3-9365d114c818.png)

**Plan**: RA Treeì—ì„œ ê° opë§ˆë‹¤ ì•Œë§ì€ ì•Œê³ ë¦¬ì¦˜ ì ìš© ê³„íš
- Each operator typically implemented using a `pull` interface
    - 1. OP `pulled` for the next output $\rarr$ `pulls` on its inputs
    - 2. Compute them.

## Two main issues in query optimization â˜…â˜…â˜…â˜…
- For a given query, **what plans are considered**?
    - Algorithm to search plan space for cheapest (estimated) plan.
- How is the **cost of a plan estimated**?

### Pipeline vs Batch
**Pipeline**
- the production of a number of temporary files â†“ $\rarr$ the efficiency of the query-evaluation â†‘ 
- faster (= least IO cost); only considering plans that we can pipeline

**Batch**
- handle multiple rows at a time
- slower

### Cost ê³„ì‚° (r/w ê°œìˆ˜) â˜…â˜…â˜…â˜…
![image](https://user-images.githubusercontent.com/39285147/205404815-99cc5f62-778a-4402-8ae8-a4d64b94e77d.png)

Two inner-loops (Pipeline)

[*outer*: faster]

![image](https://user-images.githubusercontent.com/39285147/205403947-950db85e-9a27-4aa9-bef4-77eb28fab17e.png)

[*inner*: slower]

![image](https://user-images.githubusercontent.com/39285147/205403966-28989dad-ff61-49e1-9f11-860d2d7c0347.png)

[*considered*]

![image](https://user-images.githubusercontent.com/39285147/205403876-789f2eae-8842-42a4-b5dd-24ce69a8a201.png)

[*not considered*]

![image](https://user-images.githubusercontent.com/39285147/205403826-8bb255b0-0076-46fa-ba0a-d7e965887def.png)


**Ideally**: Want to find best plan. **Practically**: Avoid worst plans!

We will study the [System R approach](#highlights-of-system-r-optimizer).

## Logical v. Physical Plan
        SELECT  S.sname
        FROM  Reserves R, Sailors S
        WHERE  R.sid=S.sid AND 
            R.bid=100 AND S.rating>5

### Logical Plan (= RA Tree)
![image](https://user-images.githubusercontent.com/39285147/204926482-c442a614-4ba9-4487-8da1-b2fa1be680f5.png)

### Physical Plan (= Plan)
- can be multiple solutions; each can have a different run time

![image](https://user-images.githubusercontent.com/39285147/204926523-d32f5076-c771-4fd4-9db4-213cf8ce1892.png)

1. generate all possible physical plans
2. estimate the run time of them
3. pick the fastest one

****
# Highlights of System R Optimizer ğŸ‘Œ
- í˜„ì¬ ê°€ì¥ ë§ì´ ì‚¬ìš©ë¨
- 10ê°œ ì´í•˜ JOINì—ì„œ ì˜ ë™ì‘
- **Cost Estimation**: Approximate art at best.
    - Statistics, maintained in system catalogs, used to estimate cost of operations and result sizes.
    - Considers combination of CPU and I/O costs.
- **Plan Space**: Too large, must be pruned.
    - Only the space of left-deep plans is considered.
        - Left-deep plans allow output of each operator to be pipelined into the next operator without storing it in a temporary relation.
    - Cartesian products avoided.

****
# Reference 
[Database Management Systems by Raghu Ramakrishnan and Johannes Gehrke](https://pages.cs.wisc.edu/~dbbook/)

[Relational Operators](https://www.javatpoint.com/dbms-relational-algebra)