---
layout: single
title: "[ë…¼ë¬¸ ë¶„ì„] RCNN"
categories: AIPaperCV
tag: [Computer Vision, Object Detection, RCNN]
toc: true
toc_sticky: true
toc_label: "ì­ŒìŠ¤log"
#author_profile: false
header:
    teaser: /assets/images/posts/od.png
sidebar:
    nav: "docs"
---

[**ë…¼ë¬¸**](https://arxiv.org/abs/1311.2524)

****
# í•œì¤„ìš”ì•½ âœ”
- Region proposalsì— CNNì„ ì ìš©. 
- Labeled dataê°€ ë¶€ì¡±í•  ë•Œ, ë³´ì¡°ì‘ì—…(auxiliary task)ë¥¼ supervised pre-trainingê³¼ ë’¤ë¥¼ ì´ì€ domain-specific fine-tuningì„ í†µí•´ ìƒë‹¹í•œ ì„±ëŠ¥ í–¥ìƒ.

****
# Introduction ğŸ™Œ
R-CNNëŠ” Regions with CNN featuresì˜ ì•½ìë¡œ, CNNê³¼ Region proposalsë¥¼ ê²°í•©í•œ ëª¨ë¸ì´ë‹¤.

****
# Proposed Method ğŸ§¿
## R-CNN êµ¬ì¡°
![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/c8f0b94b-e129-496e-8ee6-0f0bb245c2dd)

1. ì¸í’‹ ì´ë¯¸ì§€.
2. ì•½ 2,000ê°œì˜ region proposalsë¥¼ ì¶”ì¶œ (**selective search**).
3. Warping the regions to $$227 \times 227$$ (í›„ë³´ì˜ì—­ì„ CNN ì…ë ¥ìœ¼ë¡œ ë„£ê¸° ìœ„í•œ í¬ê¸°ë¡œ ì¡°ì •).
4. CNNì„ ì´ìš©í•´ ê°ê°ì˜ region proposalì˜ íŠ¹ì§• ì¶”ì¶œ.
5. Linear SVMsë¥¼ ì´ìš©í•´ ê°ê°ì˜ label ë¶„ë¥˜.

## Region Proposals
![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/c9c214ab-019c-472e-b156-d99795a89df2)

**Selective search** algorithmì„ ì‚¬ìš©í•´ ê° ì´ë¯¸ì§€ì—ì„œ 2,000ì¥ì˜ í›„ë³´ ì˜ì—­ì„ ì°¾ëŠ”ë‹¤.

### Selective Search
![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/5aef69c1-688c-468d-b45c-8860620dfd35)

1. ìƒ‰ìƒ, ì§ˆê°, ì˜ì—­í¬ê¸° ë“±ì„ ì´ìš©í•´ non-objective segmentationì„ ìˆ˜í–‰ (ì‚¬ì§„ì—ì„œ ì¢Œì¸¡).
2. Bottom-up ë°©ì‹ìœ¼ë¡œ small segemented areasë“¤ì„ í•©ì³ ë” í° segemented areasë“¤ì„ ë§Œë“¬ (ì‚¬ì§„ì—ì„œ ìš°ì¸¡).
3. (2)ì˜ ì‘ì—…ì„ ë°˜ë³µí•˜ì—¬ ìµœì¢…ì ìœ¼ë¡œ 2,000ê°œì˜ region proposalì„ ìƒì„±í•œë‹¤.

## CNN
![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/f181f1c4-bdda-4671-81b9-b556d6baa6d9)

- Input: $$227 \times 227$$ í¬ê¸°ì˜ Region proposals 2,000ê°œ 
- Output: 4,096-dimensional feature vector

R-CNNì˜ CNN êµ¬ì¡°ëŠ” pre-trained AlexNetë¥¼ ë”°ë¦…ë‹ˆë‹¤.

ì´ëŸ¬í•œ R-CNNì˜ ì¶œë ¥ì¸ 4096ì°¨ì›ì˜ íŠ¹ì§• ë²¡í„°ëŠ” ì´ë¯¸ì§€ì˜ ë‚´ìš©ì„ ì˜ ë‚˜íƒ€ë‚´ì§€ë§Œ, ì´ë¯¸ì§€ ë‚´ì— ì¡´ì¬í•˜ëŠ” ê°ì²´ì˜ í´ë˜ìŠ¤ë¥¼ êµ¬ë¶„í•˜ëŠ” ë°ëŠ” ë¶€ì¡±í•©ë‹ˆë‹¤.

ì´ê²ƒì„ ì´í›„ **Domain-specific fine-tuning**ì„ í†µí•´ CNNì„ ì¬í•™ìŠµí•˜ì—¬ ê°ì²´ì˜ í´ë˜ìŠ¤ë¥¼ êµ¬ë¶„í•˜ëŠ” ì‘ì—…ì„ ì¶”ê°€ ìˆ˜í–‰í•©ë‹ˆë‹¤.

### Domain-specific fine-tuning
![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/70d35e10-80e8-4444-bda2-24bc61de73e2)

1. ì¸í’‹ ì´ë¯¸ì§€.
2. 2,000ì¥ì˜ region proposals ìƒì„±
3. ê° region proposalì´ ground-truth boxì˜ IoU(Intersection of Union)ì™€ ë¹„êµí•˜ì—¬ IoUê°€ 0.5ë³´ë‹¤ í° ê²½ìš° positive samples, 0.5ë³´ë‹¤ ì‘ì€ ê²½ìš° negative samplesë¡œ ë‚˜ëˆ”.
- Positive sample: ê°ì²´ê°€ í¬í•¨ë˜ì–´ ìˆëŠ” sample.
- Negative sample: ê°ì²´ê°€ í¬í•¨ë˜ì§€ ì•Šì€ ë°°ê²½ sample.

> sampleì„ ë‚˜ëˆ„ë©´, ground truthë§Œ positive sampleë¡œ ì •ì˜í• ë•Œ ë³´ë‹¤ 30ë°° ë§ì€ í•™ìŠµë°ì´í„°ë¥¼ ì–»ì„ ìˆ˜ ìˆì–´ì„œ, ë§ì€ ë°ì´í„° í™œìš©ì„ í†µí•œ overfitting ë°©ì§€ê°€ ê°€ëŠ¥.

4. ë¯¸ë‹ˆ ë°°ì¹˜ ìƒì„± (positive sample 32ê°œ + negative sample 96ê°œ = 128ê°œì˜ ì´ë¯¸ì§€ë¡œ êµ¬ì„±).
5. ìƒì„±í•œ ë¯¸ë‹ˆ ë°°ì¹˜ë¥¼ ì´ìš©í•´ fine-tuning ì§„í–‰.
- Pre-trained AlexNetì˜ ë§ˆì§€ë§‰ softmax layerë¥¼ $$N+1$$-way classification ìˆ˜í–‰í•˜ë„ë¡ ìˆ˜ì •.
    - $$N$$: R-CNN ë°ì´í„°ì…‹ì— ë‹´ê¸´ ê°ì²´ ì¢…ë¥˜ì˜ ê°œìˆ˜.
    - 1ì„ ë”í•˜ì—¬ ë°°ê²½ì¸ì§€ ì—¬ë¶€ íŒë‹¨
    - Fine-tuning ë‹¨ê³„ì—ì„œë§Œ $$N+1$$ë¡œ ìˆ˜ì •ëœ softmax layer ì‚¬ìš©.
6. CNN ê²°ê³¼ì¸ í”¼ì²˜ë§µì„ Cacheì— ë”°ë¡œ ì €ì¥

> IoU
>
>> ![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/02a0a234-a97c-4abb-9891-7cdd8e6af496)

## Class and Box Prediction
![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/3331bae2-e8fa-4684-99ac-ed77f50a4c7c)

### Linear SVMs
- Output: (class, confidence score)
    - Confidence score: í•´ë‹¹ region proposalì´ ê°ì²´ë¥¼ í¬í•¨í•  í™•ë¥ 

í´ë˜ìŠ¤ ë¶„ë¥˜ë¥¼ ìœ„í•œ SVM ëª¨ë¸ì„ í•™ìŠµí•˜ëŠ” ë‹¨ê³„ì´ë‹¤.

### Bounding-box Regressor
            Input : 4096 sized feature vector
            Process : Detailed localization by Bounding box regressor
            Output : (K+1) x 4 sized vector

![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/dc8effd1-cca5-4147-b03d-ab186852dafe)

Selective search ì•Œê³ ë¦¬ì¦˜ì„ í†µí•´ ì–»ì€ ê°ì²´ì˜ ìœ„ì¹˜ëŠ” ë¶€ì •í™•í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, Bounding box regressorë¥¼ ì‚¬ìš©í•˜ì—¬ ê°ì²´ì˜ ìœ„ì¹˜ë¥¼ ì¡°ì ˆí•œë‹¤.

ìœ„ì— <span style="color:red"> ë¹¨ê°„ìƒ‰ ë„¤ëª¨ ë°•ìŠ¤ </span>ëŠ” ì˜ˆì¸¡ëœ boxì´ê³ , ê²€ì •ìƒ‰ì€ ground-truthì´ë‹¤.

ê° (x,y,w,h) ë³„ë¡œ ëŒ€ì‘ë˜ëŠ” $$d_{(x,y,w,h)}(p)$$ ë¥¼ ì˜ˆì¸¡ê°’ì— ê°ê° ê³±í•˜ì—¬ ground-truth ê°’ìœ¼ë¡œ **íšŒê·€**í•˜ë„ë¡ í•™ìŠµí•œë‹¤.

![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/22dc2ad3-9ea0-4f8b-8bbc-378082304e45)

- $$G$$: ground-truth
- $$P$$: prediction
- $$x,y,w,h$$: xì™€ yëŠ” ì˜ì—­ì˜ center, w: width, ê·¸ë¦¬ê³  h: height.

## Non Maximum Supression
![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/1faf4a1f-0c23-4643-abbc-67bb07ea8c8f)

R-CNNì„ í†µí•´ ì–»ê²Œ ë˜ëŠ” 2000ê°œì˜ bounding boxë¥¼ ì „ë¶€ ë‹¤ í‘œì‹œí•  ê²½ìš°ìš° í•˜ë‚˜ì˜ ê°ì²´ì— ëŒ€í•´ ì§€ë‚˜ì¹˜ê²Œ ë§ì€ bounding boxê°€ ê²¹ì¹œë‹¤.

í•˜ì—¬ ê° ê°ì²´ë³„ ìµœì ì˜ bounding boxë¥¼ ì„ íƒí•˜ëŠ” **Non maximum supression** ì•Œê³ ë¦¬ì¦˜ì„ ì ìš©í•œë‹¤.

1. Linear SVMì—ì„œ bounding boxë³„ë¡œ ì§€ì •í•œ confidence scroe threshold ì´í•˜ì˜ boxë¥¼ ìš°ì„  ì œê±°.
2. ë‚˜ë¨¸ì§€ bounding boxë¥¼ confidence scoreì— ë”°ë¼ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬.
3. ì‚´ì•„ë‚¨ì€ boxes ì¤‘ confidence scoreê°€ ê°€ì¥ ë†’ì€ boxë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‹¤ë¥¸ boxì™€ì˜ IoUê°’ì„ ì¡°ì‚¬í•˜ì—¬, IoU threshold ì´ìƒì¸ boxë¥¼ ëª¨ë‘ ì œê±°.
4. 3ì˜ ê³¼ì •ì„ ë°˜ë³µí•˜ì—¬ ë‚¨ì•„ìˆëŠ” boxë§Œ ì„ íƒí•œë‹¤.

****
# Conclusion âœ¨
## Strength
- VOC 2012 ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê¸°ì¡´ì˜ ë°©ë²•ë“¤(OverFeat)ë³´ë‹¤ mAP(mean average precision)ì´ 30%ì´ìƒ í–¥ìƒëœ ë³´ë‹¤ ê°„ë‹¨í•˜ê³  í™•ì¥ ê°€ëŠ¥í•œ íƒì§€ ì•Œê³ ë¦¬ì¦˜.
- Labeled dataê°€ ë¶€ì¡±í•  ë•Œ, supervised pre-trainingê³¼ ë’¤ë¥¼ ì´ì€ domain-specific fine-tuning(fine-tuned AlexNet)ì„ í†µí•´ ìƒë‹¹í•œ ì„±ëŠ¥ í–¥ìƒ.

## Weakness
- ì¸í’‹ ì´ë¯¸ì§€ í•˜ë‚˜ë‹¹ 2,000ê°œì˜ region proposal ì¶”ì¶œí•˜ê¸° ë–„ë¬¸ì— í•™ìŠµ ë° ì¶”ë¡  ì†ë„ê°€ ëŠë¦¬ë‹¤
- í•œ ë„¤íŠ¸ì›Œí¬ì—ì„œ 3ê°€ì§€ì˜ ëª¨ë¸(network, SVM, Box Regressor)ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— êµ¬ì¡°ì™€ í•™ìŠµ ê³¼ì •ì´ ë³µì¡í•˜ê³ , end-to-end í•™ìŠµ ë¶ˆê°€ëŠ¥.  
- Feature cachingì„ ìœ„í•œ disk storage í•„ìš”.

****
# Reference