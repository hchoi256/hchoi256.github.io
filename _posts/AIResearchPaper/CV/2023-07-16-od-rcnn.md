---
layout: single
title: "[ë…¼ë¬¸ ë¶„ì„] RCNN"
categories: AIPaperCV
tag: [Computer Vision, Object Detection, RCNN]
toc: true
toc_sticky: true
toc_label: "ì­ŒìŠ¤log"
#author_profile: false
header:
    teaser: /assets/images/posts/od.png
sidebar:
    nav: "docs"
---

[**ë…¼ë¬¸**](https://arxiv.org/abs/1311.2524)

****
# í•œì¤„ìš”ì•½ âœ”
- Selective searchë¡œ **region proposals ìƒì„± í›„ CNN ì¸í’‹**ìœ¼ë¡œ ì‚¬ìš©. 
- Labeled dataê°€ ë¶€ì¡±í•  ë•Œ, ë³´ì¡°ì‘ì—…ì„ **supervised pre-training**ê³¼ ë’¤ë¥¼ ì´ì€ **domain-specific fine-tuning**ì„ í†µí•´ ìƒë‹¹í•œ ì„±ëŠ¥ í–¥ìƒ.

****
# Introduction ğŸ™Œ
R-CNN ì´ì „ì—ëŠ” ì „ì²´ ì´ë¯¸ì§€ì—ì„œ íŠ¹ì§•ì„ ì¶”ì¶œí•˜ê¸° ìœ„í•´ sliding window ë°©ì‹ì„ ì‚¬ìš©í–ˆë‹¤.

ì´ëŠ” ê°ì²´ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë¶ˆí•„ìš”í•œ ë°°ê²½ ì˜ì—­ë“¤ ë˜í•œ í•™ìŠµ ëŒ€ìƒìœ¼ë¡œ ì‚¼ê¸° ë•Œë¬¸ì— í•™ìŠµ ì†ë„ê°€ ë§¤ìš° ëŠë¦° ë‹¨ì ì´ ì¡´ì¬í–ˆë‹¤.

í•˜ì—¬ R-CNNëŠ” Selective Search ë°©ë²•ìœ¼ë¡œ ì „ì²´ ì´ë¯¸ì§€ì—ì„œ **ê°ì²´ê°€ ì¡´ì¬í• ë§Œí•œ í›„ë³´ì˜ì—­(region proposals)ë“¤ë§Œ** í•™ìŠµ ëŒ€ìƒìœ¼ë¡œ ì‚¼ëŠ”ë‹¤. 

í•˜ì—¬ R-CNNì€ Regions with CNN featuresì˜ ì•½ìë¡œ, CNNê³¼ Region proposalsë¥¼ ê²°í•©í•œ ëª¨ë¸ì´ë‹¤.

****
# Proposed Method ğŸ§¿
## R-CNN êµ¬ì¡°
![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/c8f0b94b-e129-496e-8ee6-0f0bb245c2dd)

1. ì¸í’‹ ì´ë¯¸ì§€.
2. **Selective Search**: ì•½ 2,000ê°œì˜ region proposalsë¥¼ ì¶”ì¶œ.
3. **Warping:** ì¶”ì¶œí•œ í›„ë³´ì˜ì—­ì„ CNNì˜ ë™ì¼í•œ ì…ë ¥ í¬ê¸°($$227 \times 227$$)ë¡œ ì¡°ì •.
4. **CNN:** CNNì„ ì´ìš©í•´ ê°ê°ì˜ region proposalì˜ íŠ¹ì§• ì¶”ì¶œ.
5. **SVM**: Linear SVMì—ì„œ ê° í›„ë³´ì˜ì—­ì˜ label ë¶„ë¥˜.

## Region Proposals
![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/c9c214ab-019c-472e-b156-d99795a89df2)

**Selective search**ì„ ì‚¬ìš©í•´ ê° ì´ë¯¸ì§€ì—ì„œ 2,000ì¥ì˜ í›„ë³´ ì˜ì—­ì„ ì°¾ëŠ”ë‹¤.
- Pythonì—ì„œëŠ” ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ë§Œ importí•˜ì—¬ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ ì†ì‰½ê²Œ í›„ë³´ì˜ì—­ ì¶”ì¶œì´ ê°€ëŠ¥í•˜ë‹¤.

### Selective Search
![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/5aef69c1-688c-468d-b45c-8860620dfd35)

Efï¬cient GraphBased Image Segmentation ë°©ë²•ì„ ì‚¬ìš©í•´ì„œ ê°€ì¥ ì‘ì€ í”½ì…€ ë‹¨ìœ„ë¶€í„° ì´ˆê¸° í›„ë³´êµ°ì„ ì •í•˜ì—¬ ì£¼ë³€ í›„ë³´êµ°ê³¼ ìœ ì‚¬ë„ ë¹„êµë¥¼ í†µí•´ ë°˜ë³µì ì¸ ë³‘í•© ê³¼ì •ì„ ê±°ì¹œë‹¤.

1. ìƒ‰ìƒ, ì§ˆê°, ì˜ì—­í¬ê¸° ë“±ì„ ì´ìš©í•´ non-objective segmentationì„ ìˆ˜í–‰ (ì‚¬ì§„ì—ì„œ ì¢Œì¸¡).
2. Bottom-up ë°©ì‹(ì‚¬ì§„ì—ì„œ ì¢Œì¸¡ í•˜ë‹¨ $$\rightarrow$$ ìš°ì¸¡ ìƒë‹¨)ìœ¼ë¡œ small segemented areasë“¤ì„ í•©ì¹˜ë©° ë” í° segemented areasë“¤ì„ ë§Œë“ ë‹¤.
3. (2)ì˜ ì‘ì—…ì„ ë°˜ë³µí•˜ì—¬ ìµœì¢…ì ìœ¼ë¡œ ì‚¬ì „ì— ì§€ì •í•œ 2,000ê°œì˜ region proposalì„ ìƒì„±í•œë‹¤.

> ì´ˆê¸°ì—ëŠ” í”½ì…€ ë‹¨ìœ„ë¡œ segmentationí•œ í›„, ìƒ‰ìƒ ë“±ì„ ê¸°ì¤€ìœ¼ë¡œ í”½ì…€ë“¤ ê°„ ìœ ì‚¬ë„ê°€ ë†’ì€ ê²ƒë“¤ì„ í•©ì¹œë‹¤. ê°€ë ¹, í”½ì…€ë³„ ìƒ‰ìƒ ì°¨ì´ì˜ ìœ í´ë¦¬ë“œ ê±°ë¦¬(Euclidean distance)ë¥¼ ê³„ì‚°í•˜ê³  ì‚¬ì „ì— ì§€ì •í•œ ì„ê³„ê°’ë³´ë‹¤ í¬ë©´ ë‘ í”½ì…€ì„ í•©ì¹˜ê²Œ ëœë‹¤.

Selective search ê¸°ë²•ì€ CNN ë„¤íŠ¸ì›Œí¬ì˜ í•™ìŠµê³¼ ë…ë¦½ì ìœ¼ë¡œ ì ìš©ë˜ê¸° ë•Œë¬¸ì—, í•˜ë‚˜ì˜ ë„¤íŠ¸ì›Œí¬ì—ì„œ ëª¨ë“  í•™ìŠµì´ ë°œìƒí•˜ëŠ” end-to-end í•™ìŠµì˜ ê±¸ë¦¼ëŒì´ë‹¤.

í•˜ì—¬ í–¥í›„ ëª¨ë¸ì—ì„œëŠ” í›„ë³´ì˜ì—­ íƒìƒ‰ ê³¼ì • ìì²´ë¥¼ í•™ìŠµ ëŒ€ìƒìœ¼ë¡œ ì‚¼ì•„ ë„¤íŠ¸ì›Œí¬ì— ë‚´ë¶€ë¡œ í¬í•¨ì‹œí‚¨ë‹¤.

## CNN
![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/f181f1c4-bdda-4671-81b9-b556d6baa6d9)

- Input: $$227 \times 227$$ í¬ê¸°ì˜ Region proposals 2,000ê°œ 
- Output: 4,096-dimensional feature vector

R-CNNì˜ CNN êµ¬ì¡°ëŠ” pre-trained AlexNetë¥¼ ë”°ë¦…ë‹ˆë‹¤.

ë³¸ ë…¼ë¬¸ì—ì„œëŠ” **Domain-specific fine-tuning** ê³¼ì •ì„ í†µí•´ CNN ë„¤íŠ¸ì›Œí¬ë¥¼ íŠ¹ì • ê°ì²´ íƒì§€ ì‘ì—…ì— ë” ì í•©í•˜ê²Œ ë™ì‘í•˜ë„ë¡ ì¡°ì •í•˜ë„ë¡ í•©ë‹ˆë‹¤.

ì´ë¥¼ í†µí•´ CNN ë„¤íŠ¸ì›Œí¬ëŠ” í•´ë‹¹ ì‘ì—…ì— íŠ¹í™”ëœ íŠ¹ì§•ì„ ë” ì˜ ì¶”ì¶œí•˜ë„ë¡ íŒŒë¼ë¯¸í„°ë¥¼ ì¡°ì •í•©ë‹ˆë‹¤.

### Domain-specific fine-tuning
![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/70d35e10-80e8-4444-bda2-24bc61de73e2)

1. ì¸í’‹ ì´ë¯¸ì§€.
2. 2,000ì¥ì˜ region proposals ìƒì„±
3. ê° region proposalì´ ground-truth boxì˜ IoU(Intersection of Union)ì™€ ë¹„êµí•˜ì—¬ IoUê°€ 0.5ë³´ë‹¤ í° ê²½ìš° positive samples, 0.5ë³´ë‹¤ ì‘ì€ ê²½ìš° negative samplesë¡œ ë‚˜ëˆ”.
- Positive sample: ê°ì²´ê°€ í¬í•¨ë˜ì–´ ìˆëŠ” sample.
- Negative sample: ê°ì²´ê°€ í¬í•¨ë˜ì§€ ì•Šì€ ë°°ê²½ sample.
4. ë¯¸ë‹ˆ ë°°ì¹˜ ìƒì„± (positive sample 32ê°œ + negative sample 96ê°œ = 128ê°œì˜ ì´ë¯¸ì§€ë¡œ êµ¬ì„±).
5. ìƒì„±í•œ ë¯¸ë‹ˆ ë°°ì¹˜ë¥¼ ì´ìš©í•´ CNN ë„¤íŠ¸ì›Œí¬(AlexNet)ë¥¼ fine-tuning.

- Pre-trained AlexNetì˜ ë§ˆì§€ë§‰ softmax layerë¥¼ $$(N+1)$$-way classification ìˆ˜í–‰í•˜ë„ë¡ ìˆ˜ì •.
    - $$N$$: R-CNN ë°ì´í„°ì…‹ì— ë‹´ê¸´ ê°ì²´ ì¢…ë¥˜ì˜ ê°œìˆ˜.
    - $$N+1$$: ì—¬ê¸°ì„œ $$1$$ì€ ë°°ê²½ì¸ì§€ ì—¬ë¶€ íŒë‹¨
    - Fine-tuning ë‹¨ê³„ì—ì„œë§Œ $$N+1$$ë¡œ ìˆ˜ì •ëœ softmax layer ì‚¬ìš©.

6. CNN ê²°ê³¼ì¸ í”¼ì²˜ë§µì„ Cacheì— ë”°ë¡œ ì €ì¥

> Sampleì„ ë‚˜ëˆ„ë©´, ground truthë§Œ positive sampleë¡œ ì •ì˜í• ë•Œ ë³´ë‹¤ 30ë°° ë§ì€ í•™ìŠµë°ì´í„°ë¥¼ ì–»ì„ ìˆ˜ ìˆì–´ì„œ, ë§ì€ ë°ì´í„° í™œìš©ì— ë”°ë¥¸ overfitting ë°©ì§€ê°€ ê°€ëŠ¥.

> IoU
>
>> ![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/02a0a234-a97c-4abb-9891-7cdd8e6af496)

## Class and Box Prediction
![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/3331bae2-e8fa-4684-99ac-ed77f50a4c7c)

### Linear SVMs
- Output: (class, confidence score)
    - Confidence score: í•´ë‹¹ region proposalì´ ê°ì²´ë¥¼ í¬í•¨í•  í™•ë¥ ë¡œ SVM ëª¨ë¸ì˜ ìµœì¢… sigmoid ì¶œë ¥ê°’ì´ë‹¤.

í´ë˜ìŠ¤ ë¶„ë¥˜ë¥¼ ìœ„í•œ SVM ëª¨ë¸ì„ í•™ìŠµí•˜ëŠ” ë‹¨ê³„ì´ë‹¤.

### Bounding-box Regressor
            Input : 4096 sized feature vector
            Process : Detailed localization by Bounding box regressor
            Output : (K+1) x 4 sized vector

![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/dc8effd1-cca5-4147-b03d-ab186852dafe)

Selective search ì•Œê³ ë¦¬ì¦˜ì„ í†µí•´ ì–»ì€ ê°ì²´ì˜ ìœ„ì¹˜ëŠ” ë¶€ì •í™•í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, Bounding box regressorë¥¼ ì‚¬ìš©í•˜ì—¬ ê°ì²´ì˜ ìœ„ì¹˜ë¥¼ ì¡°ì ˆí•œë‹¤.

ìœ„ì— <span style="color:red"> ë¹¨ê°„ìƒ‰ ë„¤ëª¨ ë°•ìŠ¤ </span>ëŠ” ì˜ˆì¸¡ëœ boxì´ê³ , ê²€ì •ìƒ‰ì€ ground-truthì´ë‹¤.

ê° (x,y,w,h) ë³„ë¡œ ëŒ€ì‘ë˜ëŠ” $$d_{(x,y,w,h)}(p)$$ ë¥¼ ì˜ˆì¸¡ê°’ì— ê°ê° ê³±í•˜ì—¬ ground-truth ê°’ìœ¼ë¡œ **íšŒê·€**í•˜ë„ë¡ í•™ìŠµí•œë‹¤.

![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/22dc2ad3-9ea0-4f8b-8bbc-378082304e45)

- $$G$$: ground-truth
- $$P$$: prediction
- $$x,y,w,h$$: xì™€ yëŠ” ì˜ì—­ì˜ center, w: width, ê·¸ë¦¬ê³  h: height.

## Non Maximum Supression
![image](https://github.com/hchoi256/ai-boot-camp/assets/39285147/1faf4a1f-0c23-4643-abbc-67bb07ea8c8f)

R-CNNì„ í†µí•´ ì–»ê²Œ ë˜ëŠ” 2000ê°œì˜ bounding boxë¥¼ ì „ë¶€ ë‹¤ í‘œì‹œí•  ê²½ìš°ìš° í•˜ë‚˜ì˜ ê°ì²´ì— ëŒ€í•´ ì§€ë‚˜ì¹˜ê²Œ ë§ì€ bounding boxê°€ ê²¹ì¹œë‹¤.

í•˜ì—¬ ê° ê°ì²´ë³„ ìµœì ì˜ bounding boxë¥¼ ì„ íƒí•˜ëŠ” **Non maximum supression** ì•Œê³ ë¦¬ì¦˜ì„ ì ìš©í•œë‹¤.

1. Linear SVMì—ì„œ bounding boxë³„ë¡œ ì§€ì •í•œ confidence scroe threshold ì´í•˜ì˜ boxë¥¼ ìš°ì„  ì œê±°.
2. ë‚˜ë¨¸ì§€ bounding boxë¥¼ confidence scoreì— ë”°ë¼ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬.
3. ì‚´ì•„ë‚¨ì€ boxes ì¤‘ confidence scoreê°€ ê°€ì¥ ë†’ì€ boxë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‹¤ë¥¸ boxì™€ì˜ IoUê°’ì„ ì¡°ì‚¬í•˜ì—¬, IoU threshold ì´ìƒì¸ boxë¥¼ ëª¨ë‘ ì œê±°.
4. 3ì˜ ê³¼ì •ì„ ë°˜ë³µí•˜ì—¬ ë‚¨ì•„ìˆëŠ” boxë§Œ ì„ íƒí•œë‹¤.

****
# Conclusion âœ¨
## Strength
- VOC 2012 ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê¸°ì¡´ì˜ ë°©ë²•ë“¤(OverFeat)ë³´ë‹¤ mAP(mean average precision)ì´ 30%ì´ìƒ í–¥ìƒëœ ë³´ë‹¤ ê°„ë‹¨í•˜ê³  í™•ì¥ ê°€ëŠ¥í•œ íƒì§€ ì•Œê³ ë¦¬ì¦˜.
- Labeled dataê°€ ë¶€ì¡±í•  ë•Œ, supervised pre-trainingê³¼ ë’¤ë¥¼ ì´ì€ domain-specific fine-tuning(fine-tuned AlexNet)ì„ í†µí•´ ìƒë‹¹í•œ ì„±ëŠ¥ í–¥ìƒ.

## Weakness
- ì¸í’‹ ì´ë¯¸ì§€ í•˜ë‚˜ë‹¹ 2,000ê°œì˜ region proposal ì¶”ì¶œí•˜ê¸° ë–„ë¬¸ì— í•™ìŠµ ë° ì¶”ë¡  ì†ë„ê°€ ëŠë¦¬ë‹¤
- í•œ ë„¤íŠ¸ì›Œí¬ì—ì„œ 3ê°€ì§€ì˜ ëª¨ë¸(network, SVM, Box Regressor)ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— êµ¬ì¡°ì™€ í•™ìŠµ ê³¼ì •ì´ ë³µì¡í•˜ê³ , end-to-end í•™ìŠµ ë¶ˆê°€ëŠ¥.
    - CNN íŒŒì¸ íŠœë‹ 1íšŒ, SVM í•™ìŠµ 1íšŒ, box regressor í•™ìŠµ 1íšŒ
- Feature cachingì„ ìœ„í•œ disk storage í•„ìš”.

****
# Reference