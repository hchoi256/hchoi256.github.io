---
layout: single
title: "[ë…¼ë¬¸ë¶„ì„] Grad-CAM: Visual Explanations from Deep Networks via Gradient-based Localization (ICCV 2017)"
categories: AIPaperCV
tag: [Computer Vision, CAM, Grad-CAM, Object Localization]
toc: true
toc_sticky: true
toc_label: "ì­ŒìŠ¤log"
author_profile: false
header:
    teaser: /assets/images/posts/od.png
sidebar:
    nav: "docs"
---

<span style="color:sky"> [ë…¼ë¬¸ë§í¬](https://arxiv.org/pdf/1610.02391.pdf) </span>.

****
# í•œì¤„ìš”ì•½ âœ”
- ë”¥ëŸ¬ë‹ ëª¨ë¸ì˜ ê²°ê³¼ì˜ ê·¼ê±°ë¥¼ ìœ ì¶”í•  ìˆ˜ ì—†ë‹¤ëŠ” blackbox í˜„ìƒì„ í•´ê²°í•˜ê³ ì object localizationì„ ìˆ˜í–‰í•˜ëŠ” `CAM` ì´ ê³ ì•ˆë˜ì—ˆë‹¤.
    - Constraint: GAP ì´í›„ FC layer í•œê°œë§Œ ì—°ê²°ë˜ì–´ ìˆëŠ” êµ¬ì¡°ì—¬ì•¼ í•œë‹¤.
- íŠ¹ì • êµ¬ì¡°ì— êµ­í•œëœ `CAM` ì˜ í™œìš©ë„ë¥¼ í™•ì¥í•˜ê³ ì `Grad-CAM` ì´ ë“±ì¥.
    - ê¸°ì¡´ CAMì—ì„œ FC-layerì˜ weightsê°€ ì•„ë‹Œ Gradientì„ ê¸°ë°˜ìœ¼ë¡œ íŠ¹ì • classì— ëŒ€í•œ feature mapì˜ ì˜í–¥ë ¥ì„ ê³„ì‚°.
- `CAM`ê³¼ `Grad-CAM`ì˜ ì„±ëŠ¥ì€ ê°™ì§€ë§Œ, í™œìš© ë²”ìœ„ë§Œ ë‹¤ë¥´ë‹¤.

****
# Preliminaries ğŸ±
## CAM
### Model Architecture
![image](https://github.com/hchoi256/hchoi256.github.io/assets/39285147/7f1ac706-7a16-42be-b7ec-8b22ff21a26b)

- CNNì˜ ìµœì¢… layer ì¶œë ¥ì¸ feature mapì— channel-wise ê³„ì‚°ë²•ì¸ GAPë¥¼ ì ìš©í•˜ì—¬ feature mapì˜ spatial info.ë¥¼ ìœ ì§€ (ê¸°ì¡´ CAMì—ì„œëŠ” 1ì°¨ì› ë°°ì—´ë¡œ point-wiseí•˜ê²Œ flattenì‹œí‚¨ í›„ fc-layerì˜ ì¸í’‹ìœ¼ë¡œ í™œìš©í•œë‹¤).
    - ê° ì±„ë„ì€ ì´ë¯¸ì§€ì—ì„œ ê° ê°ì²´ì˜ íŠ¹ì§•ì„ í‘œí˜„í•œë‹¤ (ì±„ë„ ê°œìˆ˜=ì»¤ë„ ê°œìˆ˜).
    
![image](https://github.com/hchoi256/hchoi256.github.io/assets/39285147/49132aea-08ab-4392-9494-dab4c2ed9386)

- ì´í›„, FC-layerì—ì„œ ê° íŠ¹ì§•ì„ ë‹´ê³ ìˆëŠ” feature mapì˜ í‰ê· ê°’ì„ ì¸í’‹ìœ¼ë¡œ ë°›ê³ , ê° ì¸í’‹ì˜ ê° classì— ëŒ€í•œ ë¯¼ê°ë„ë¥¼ softmaxë¥¼ ê±°ì³ weightsë¡œ í‘œí˜„í•œë‹¤. 

### Equation
$$Y^c=\Sigma_k w^c_k {1 \over Z} \Sigma_{i,j} A^k_{i,j}$$

- $$Y^c$$: class $$c$$ì— ëŒ€í•œ score (ëª¨ë¸ ì˜ˆì¸¡ logit/output).
- $${1 \over Z} \Sigma_{i,j} A^k_{i,j}$$:  feature map $$k$$ì˜ GAP ê°’.
    - $$Z$$: feature map $$k$$ì—ì„œ pixel ê°œìˆ˜.
- $$w^c_k$$: feature map $$k$$ì˜ class $$c$$ì— ëŒ€í•œ ë¯¼ê°ë„.
- $$A^k_{i,j}$$: feature map $$k$$ì˜ $$i,j$$ì— í•´ë‹¹í•˜ëŠ” pixel ê°’.

****
# Challenges and Main IdeağŸ’£
**C1)** <span style="color:orange"> CAMì€ íŠ¹ì • êµ¬ì¡°ì—ì„œë§Œ ì ìš© ê°€ëŠ¥í•œ ëª¨ë¸ì´ë‹¤. </span>.

**Idea)** <span style="color:lightgreen"> Grad-CAMì€ gradient ê³„ì‚°ì„ í†µí•´ êµ¬ì¡°ì— êµ¬ì• ë°›ì§€ ì•ŠëŠ”ë‹¤. </span>.

****
# Problem Definition â¤ï¸
**Given** a CNN-based model $$\mathcal{T}$$.

**Return** a model $$\mathcal{S}$$.

**Such that $$\mathcal{S}$$** performs class prediction with reasoning for the output.

****
# Proposed Method ğŸ§¿
## Model Architecture
![image](https://github.com/hchoi256/hchoi256.github.io/assets/39285147/5ac56726-477f-454e-9e02-409d201d199b)

- `Grad-CAM`ì€ `CAM`ì˜ ì¼ë°˜í™” ë²„ì „ì´ë‹¤.
    - FC-layerì—ì„œ weightsë¥¼ ì‚¬ìš©í•˜ëŠ” `CAM`ê³¼ ë‹¬ë¦¬ GAP ì´í›„ ì–´ë–¤ networkê°€ ë’¤ë”°ë¼ë„ weightsë¥¼ gradientë¡œ ëŒ€ì²´í•œ ì•Œê³ ë¦¬ì¦˜ ë•ë¶„ì— task ìˆ˜í–‰ì´ ê°€ëŠ¥í•˜ë‹¤.

## Loss Function
<span style="color:yellow"> $$L^c_{Grad_CAM}=ReLU(M^c_{i,j})$$ </span>

- $$M^c_{i,j}=\Sigma_k a^c_k A^k_{i,j}$$: ì¢Œí‘œ $$i,j$$ì˜ class $$c$$ì— ëŒ€í•œ ë¯¼ê°ë„.
    - $$a^c_k={1 \over Z} \Sigma_{i,j} {\partial Y^c \over \partial A^k_{i,j}}$$: gradients.
        - `CAM` ì—ì„œì˜ weights $$w^c_k$$ ë¥¼ ìƒê¸° ì‹ìœ¼ë¡œ ëŒ€ì²´.

### How to calculate $$a^c_k=w^c_k$$?
`CAM`ì—ì„œ $$Y^c$$ë¥¼ ê³„ì‚°í•˜ëŠ” ê³¼ì •ì˜ feature $$k$$ì— ëŒ€í•˜ì—¬ $$w^c_k$$ ë¥¼ ì‚¬ìš©í•˜ëŠ” FC-layer ë°”ë¡œ ì§ì „ layerëŠ” GAP ê²°ê³¼ë¥¼ $$F^k$$ ë¼ê³  ë¶€ë¥´ê² ë‹¤.

- <span style="color:yellow"> $$F^k={1 \over Z} \Sigma_{i,j} A^k_{i,j}$$ </span>.

ëª¨ë¸ logitì¸ $$Y^c$$ë¥¼ GAP ì¶œë ¥ $$F^k$$ìœ¼ë¡œ í¸ë¯¸ë¶„í•˜ì—¬ ì–»ì€ gradientëŠ” Chain Ruleì„ í†µí•´ ë‹¤ìŒ ì‹ì²˜ëŸ¼ $$A^k_{i,j}$$ ë¥¼ ì‚¬ìš©í•˜ì—¬ ì „ê°œë  ìˆ˜ ìˆë‹¤.

- <span style="color:yellow"> $$(1)\ {\partial Y^c \over \partial F^k}={{\partial Y^c \over \partial A^k_{i,j}} \over {\partial F^k \over \partial A^k_{i,j}}}$$. <span>

ì—¬ê¸°ì„œ $$F^k$$ ì˜ ì‹ì„ ì°¸ì¡°í•˜ì—¬ ê° íŒŒë¼ë¯¸í„°ì— ëŒ€í•œ í¸ë¯¸ë¶„ ê°’ì„ ë‹¤ìŒê³¼ ê°™ì´ ê³„ì‚°í•  ìˆ˜ ìˆë‹¤. 

- $${\partial Y^c \over \partial A^k_{i,j}}=w^c_k$$.
- $${\partial F^k \over \partial A^k_{i,j}}={1 \over Z}$$.

ì´ í¸ë¯¸ë¶„ ê°’ì„ $$(1)$$ì— ëŒ€ì…í•˜ì—¬ ë‹¤ìŒ ì‹ì„ ì–»ì„ ìˆ˜ ìˆê³ , ì´ë¥¼ í•œ ë‹¨ê³„ ë” ì „ê°œí•˜ë©´ `Grad-CAM`ì˜ gradient $$a^c_k$$ê³¼ `CAM`ì˜ weights $$w^c_k$$ ì˜ ê´€ê³„ê°€ ë„ì¶œëœë‹¤.
- <span style="color:yellow"> $$w^c_k={\partial Y^c \over \partial A^k_{i,j}} \cdot Z$$ </span>.
- <span style="color:yellow"> $$\Sigma_{i,j} w^c_k= \Sigma_{i,j} {\partial Y^c \over \partial A^k_{i,j}} \cdot Z=Z \Sigma_{i,j} {\partial Y^c \over \partial A^k_{i,j}}$$ </span>.
    - $$Z=\Sigma_{i,j} 1$$.
        - $$i \times j=Z;\ where\ Z\ is\ \#\ pixels$$.
- $$w^c_k=a^c_k$$.

****
# Experiment ğŸ‘€
![image](https://github.com/hchoi256/hchoi256.github.io/assets/39285147/3befc3a7-84a3-461b-bfb2-7e207402198d)

`CAM`ê³¼ ì„±ëŠ¥ ìì²´ëŠ” ë¹„ìŠ·í•˜ë‹ˆ ìƒëµí•˜ê³ , `Grad-CAM`ì„ ì‚¬ìš©í•˜ì—¬ PASCAL VOC 2012 datasetì—ì„œ segmentation ìˆ˜í–‰ ê²°ê³¼ë¡œ ìì„¸í•œ ì„¤ëª…ì€ ê°ì„¤í•œë‹¤. 

****
# Open Reivew ğŸ’—
NA

****
# Discussion ğŸŸ
NA

****
# Major Takeaways ğŸ˜ƒ
NA

****
# Conclusion âœ¨
NA

****
# Reference
https://joungheekim.github.io/2020/10/14/paper-review/