---
layout: single
title: "[ÏûêÏú®Ï£ºÌñâ ÏãúÎÆ¨Î†àÏù¥ÌÑ∞] CARLA Road Side Unit(RSU) Ïù¥Ìï¥"
categories: CV
tag: [CARLA, Window, Python, RSU]
toc: true
toc_sticky: true
toc_label: "Ï≠åÏä§log"
#author_profile: false
header:
    teaser: /assets/images/posts/carla.jpg
sidebar:
    nav: "docs"
---

# INTRO üôå
Ïù¥Ï†Ñ ÏãúÍ∞ÑÏóêÎäî CARLA Í∏∞Î≥∏ Í∞úÎ∞ú Îä•Î†•ÏùÑ Ïó∞ÎßàÌñàÎã§.

Ïù¥Î≤àÏóêÎäî CARLA ÏãúÎÆ¨Î†àÏù¥ÌÑ∞Î•º ÌôúÏö©Ìï¥ÏÑú **RSU**Î•º Íµ¨ÌòÑÌï¥Î≥¥Ïûê.

> ÏΩîÎìú Î∂ÑÏÑùÏùÄ Í∞Å ÎùºÏù∏Î≥Ñ Ï£ºÏÑùÏúºÎ°ú ÎåÄÏ≤¥ÌïúÎã§.
>
> [GitHub Repository](#reference)ÏóêÏÑú Ïù¥Î≤à ÌïôÏäµ Î™®Îìà(Learning Task 4 & 5)Í¥ÄÎ†® ÌååÏùºÏùÑ Ïó¥ÎûåÌï† Ïàò ÏûàÎã§.

# RSU ÎûÄ? üéÜ
![image](https://user-images.githubusercontent.com/39285147/195055243-80f95216-6392-479f-a933-239f6042ee2e.png)

1ÎåÄ Ïù¥ÏÉÅÏùò ÌÉëÏû¨Ïû•ÏπòÏôÄ Îç∞Ïù¥ÌÑ∞ ÌÜµÏã†ÏùÑ ÌïòÍ∏∞ ÏúÑÌïòÏó¨ ÎèÑÎ°úÎ≥ÄÏóê ÏÑ§ÏπòÎêú Í≥†Ï†ï ÌÜµÏã†Ïû•ÏπòÎ°ú, RSU(Road Side Unit) ÎòêÎäî Í≥†Ï†ïÏû•ÏπòÏôÄ ÎèôÏùºÌïú ÏùòÎØ∏Î•º Í∞ÄÏßÑÎã§.

ÏâΩÍ≤å ÎßêÌï¥ÏÑú, ÎèÑÎ°úÏóê ÏÑ§ÏπòÎêòÏñ¥ Ï£ºÎ≥Ä ÏßÄÎÇòÏπòÎäî Ï∞®ÎüâÍ≥º Ï†ïÎ≥¥ ÌÜµÏã†ÏùÑ ÌÜµÌï¥ ÎÑ§Ïù¥Í≤åÏù¥ÏÖò Ï†ïÎ≥¥ Îì±ÏùÑ Ïã§ÏãúÍ∞ÑÏúºÎ°ú Ï£ºÍ≥†Î∞õÍ≤å ÎèÑÏôÄÏ£ºÎäî ÌÜµÏã†ÎßùÏù¥Îùº Ïù¥Ìï¥ÌïòÎ©¥ ÎêúÎã§.

Ïù¥Î≤à ÏòàÏ†úÏóêÏÑúÎäî Í≥µÏÇ¨ Íº¨Íπî, ÎèÑÎ°ú ÌëúÏßÄÌåê Îì± RSU Í∞ùÏ≤¥ÏôÄ ÏßÄÎÇòÏπòÎäî ÏûêÎèôÏ∞® ÏÇ¨Ïù¥Î•º Î†àÏù¥Ï†ÄÎ°ú ÌëúÌòÑÌïòÍ≥† Í±∞Î¶¨Î•º Î∞òÌôòÌïòÎäî ÌÜµÏã† ÏãúÏä§ÌÖúÏùÑ Íµ¨ÌòÑÌï¥Î≥¥Ïûê.

# CARLAÏóêÏÑú RSU Íµ¨ÌòÑ
Ïö∞ÏÑ† ÎåÄÌëúÏ†ÅÏù∏ RSU Ïò§Î∏åÏ†ùÌä∏Ïù∏ ÎèÑÎ°ú ÌëúÏßÄÌåêÏùÑ blueprintÏóêÏÑú Í∞ÄÏ†∏ÏôÄ ÏÉùÏÑ±Ìï¥Î≥¥Ïûê.

Ïù¥Ï†Ñ ÌîÑÎ°úÏ†ùÌä∏ÏóêÏÑú Îã§Î£¨ ÎÇ¥Ïö©Ïù¥Îãà ÎîîÌÖåÏùºÏùÄ Í≥ºÍ∞êÌûà ÏÉùÎûµÌïúÎã§.

                rsu_bp_1 = blueprint_library.find('static.prop.streetsign')
                spawn_point_rsu1 = carla.Transform(carla.Location(x=-57, y=61.22, z=6.5), carla.Rotation(pitch=0.000000, yaw=0.000000, roll=0.000000))
                rsu1 = world.spawn_actor(rsu_bp_1, spawn_point_rsu1)
                actor_list.append(rsu1)

Ïù¥ÌõÑ Testing ÌôòÍ≤ΩÏóêÏÑú, Ìñ•ÏÉÅÎêú RSU Í¥ÄÏ∞∞ÏùÑ Î™©Í≤©ÌïòÍ∏∞ ÏúÑÌï¥ Ïπ¥Î©îÎùº ÏãúÏ†êÏùÑ Ï°∞Ï†ïÌï¥Î≥¥Ïûê.

                spectator = world.get_spectator()
                rsu_transform = rsu1.get_transform()
                spectator.set_transform(carla.Transform(rsu_transform.location, carla.Rotation(pitch=-35)))

Ïù¥Ï†ú, Testing ÌôòÍ≤ΩÏóê ÌïÑÏöîÌïú Ïò§ÌÜ†ÌååÏùºÎüø Î™®ÎìúÎ°ú ÏõÄÏßÅÏó¨ Îã§ÎãàÎäî Î¨¥ÏûëÏúÑ ÏûêÎèôÏ∞®Î•º ÏÉùÏÑ±Ìï¥Î≥¥Ïûê.

                # Generate NPC vehicles
                if SPAWN_NPC_VEHICLES == 1:
                        for i in range(NPC_VEH_NUM):
                                # Choose random blueprint and choose the i-th default spawn points
                                vehicle_bp_i = random.choice(blueprint_library.filter('vehicle.*.*'))
                                spawn_point_i = spawn_points[i]
                                print(spawn_point_i.location, spawn_point_i.rotation)
                                # Spawn the actor
                                vehicle_i = world.try_spawn_actor(vehicle_bp_i, spawn_point_i)

                                # Append to the actor_list
                                if vehicle_i != None:
                                        actor_list.append(vehicle_i)
                                        vehicle_list.append(vehicle_i)
                        print('%d vehicles are generated' % len(vehicle_list))

                        # Set autopilot for each vehicle
                        for vehicle_i in vehicle_list:
                                vehicle_i.set_autopilot(True)
                        
Ïù¥Ï†Ñ ÌîÑÎ°úÏ†ùÌä∏ÏóêÏÑú Î∞∞Ïö¥ Î∞©Î≤ïÏúºÎ°ú Í≥µÏÇ¨ Íº¨Íπî ÎòêÌïú Ïó¨Îü¨ Í∞ú ÏÉùÏÑ±ÌñàÎã§.

![image](https://user-images.githubusercontent.com/39285147/195055941-fe13299d-e836-4349-8757-3d82d5545e2e.png)

Ïù¥Ï†ú, ÏÉùÏÑ±Ìïú Í≥µÏÇ¨ Íº¨Í∞àÍ≥º ÏßÄÎÇòÏπòÎäî ÏûêÎèôÏ∞® ÏÇ¨Ïù¥Î•º ÏãúÍ∞ÅÏ†ÅÏúºÎ°ú ÎÇòÌÉÄÎÇ¥Î≥¥Ïûê.

                while True:
                        if iter >= max_iteration:
                                break
                        world_snapshot = world.get_snapshot()
                        timestamp = world_snapshot.timestamp.elapsed_seconds # Get the time reference
                        
                        if iter == 1:
                                # Visulize static information:
                                # Construction zone
                                if VISUALIZE_CONSTRUCTION_ZONE == 1:
                                        h = carla.Location(x=0, y=0, z=1)
                                        # Add a text to the RSU
                                        world.debug.draw_string(location=rsu1.get_location(), text='RSU', draw_shadow=True, color=carla.Color(255, 0, 0), life_time=max_time)
                                        # Draw 5 boundaries
                                        world.debug.draw_line(begin=cone_1.get_location()+h, end=cone_2.get_location()+h, color=carla.Color(255, 0, 0), life_time=max_time)
                                        world.debug.draw_line(begin=cone_2.get_location()+h, end=cone_3.get_location()+h, color=carla.Color(255, 0, 0), life_time=max_time)
                                        world.debug.draw_line(begin=cone_3.get_location()+h, end=cone_4.get_location()+h, color=carla.Color(255, 0, 0), life_time=max_time)
                                        world.debug.draw_line(begin=cone_4.get_location()+h, end=cone_5.get_location()+h, color=carla.Color(255, 0, 0), life_time=max_time)
                                        world.debug.draw_line(begin=cone_5.get_location()+h, end=cone_1.get_location()+h, color=carla.Color(255, 0, 0), life_time=max_time)

![image](https://user-images.githubusercontent.com/39285147/195057376-ac9284b6-7180-4b00-b289-bf827df28171.png)

                                # Detection area
                                if VISUALIZE_DETECTION_AREA:
                                        h_detect = 0.3
                                        corner_1 = carla.Location(x=rsu1.get_location().x, y=cone_1.get_location().y) + carla.Location(x=0, y=-DETECTION_RANGE, z=h_detect)
                                        corner_2 = cone_2.get_location() + carla.Location(x=DETECTION_RANGE, y=-DETECTION_RANGE, z=h_detect)
                                        corner_3 = cone_4.get_location() + carla.Location(x=DETECTION_RANGE, y=DETECTION_RANGE, z=h_detect)
                                        corner_4 = carla.Location(x=rsu1.get_location().x, y=cone_5.get_location().y) + carla.Location(x=0, y=DETECTION_RANGE, z=h_detect)
                                        # Draw 4 boundaries
                                        world.debug.draw_line(begin=corner_1, end=corner_2, thickness=0.03, color=carla.Color(255, 255, 0), life_time=max_time)
                                        world.debug.draw_line(begin=corner_2, end=corner_3, thickness=0.03, color=carla.Color(255, 255, 0), life_time=max_time)
                                        world.debug.draw_line(begin=corner_3, end=corner_4, thickness=0.03, color=carla.Color(255, 255, 0), life_time=max_time)
                                        world.debug.draw_line(begin=corner_4, end=corner_1, thickness=0.03, color=carla.Color(255, 255, 0), life_time=max_time)

![image](https://user-images.githubusercontent.com/39285147/195057334-abce354d-40a7-46c6-b277-dace4326abe8.png)

Ïù¥Ï†ú, RSU ÌÜµÏã†Ïùò Ïã§ÏßàÏ†Å Î™©ÌëúÏù∏ RSU ~ ÏûêÎèôÏ∞® ÏÇ¨Ïù¥ Í±∞Î¶¨Î•º Í≥ÑÏÇ∞Ìï¥Î≥¥Ïûê.

                for i in range(len(vehicle_list)):
                        vehicle = vehicle_list[i]
                        v_x = vehicle.get_location().x
                        v_y = vehicle.get_location().y
                        
                        for j in range(len(cone_list)):
                                cone = cone_list[j]
                                c_x = cone.get_location().x
                                c_y = cone.get_location().y

                                # Calculate the distance between each vehicle and each cone
                                dist_x = np.abs(v_x - c_x)
                                dist_y = np.abs(v_y - c_y)

                                # If the vehicle is within the detection area, assume RSU could send this message to the vehicle.
                                if dist_x < DETECTION_RANGE and dist_y < DETECTION_RANGE:
                                
                                # Visualize the communication process
                                if VISUALIZE_COMMUNICATION == 1:
                                        world.debug.draw_line(begin=rsu1.get_location(), end=vehicle.get_location()+carla.Location(z=0.6), color=carla.Color(64, 255, 0), life_time=dt)
                                break

![image](https://user-images.githubusercontent.com/39285147/195057989-d1f36c69-7c50-4ba5-8925-1cdcf6ff0d3b.png)

![image](https://user-images.githubusercontent.com/39285147/195058133-f035a0bd-6e87-4095-9d01-172c913c82e2.png)

ÏΩòÏÜîÏ∞ΩÏóêÏÑú ÏÇ¨Ïù¥ Í±∞Î¶¨Î•º Î∞òÌôòÌïòÎäî Î™®ÏäµÏù¥Í≥†, CARLA ÏãúÎÆ¨Î†àÏù¥ÌÑ∞ÏóêÏÑúÎäî ÏÇ¨Ïù¥ Íµ¨Í∞ÑÏùÑ ÏãúÍ∞ÅÏ†ÅÏúºÎ°ú Î≥¥Ïó¨Ï£ºÎäî Î™®ÏäµÏù¥Îã§.

# Reference
[**GitHub Repository**](https://github.com/hchoi256/carla-research-project)

[*UW Madison CARLA Research Team*](https://cavh.cee.wisc.edu/carla-simulation-project/)

[*CARLA Simulator*](https://carla.readthedocs.io/en/latest/)