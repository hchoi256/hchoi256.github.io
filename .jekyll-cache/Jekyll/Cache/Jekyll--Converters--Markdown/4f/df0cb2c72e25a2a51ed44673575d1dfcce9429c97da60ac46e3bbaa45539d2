I"a¢<h1 id="code">Code</h1>
<p class="notice--danger"><strong>[Notice]</strong> <a href="https://github.com/hchoi256/machine-learning-development">download here</a></p>

<h1 id="learning-goals">Learning Goals</h1>
<ol>
  <li>í•©ì„±ê³± ì‹ ê²½ë§ ëª¨ë¸ ì„¤ê³„í•˜ì—¬ ì¼€ë¼ìŠ¤ë¡œ ì´ë¯¸ì§€ ë¶„ë¥˜ <span style="color: blue">Building the CNN and Image classification using keras</span></li>
  <li>Adam ì˜µí‹°ë§ˆì´ì €ë¡œ ì‹ ê²½ë§ ê°€ì¤‘ì¹˜ ìµœì í™” <span style="color: blue">Optimizing weights using â€˜Adamâ€™</span></li>
  <li>ë“œë¡­ì•„ì›ƒì„ í†µí•œ ê³¼ì í•© ê°œì„ <span style="color: blue"> Drop-out</span></li>
  <li>ëª¨ë¸ í‰ê°€ ì§„í–‰ (<em>confusion matrix</em>) <span style="color: blue">Model evaluation</span></li>
  <li><em>Image Augmentation</em>ìœ¼ë¡œ ì‹ ê²½ë§ ì¼ë°˜í™” ì„±ëŠ¥ ê°œì„  <span style="color: blue">Improving generalization error through image augmentation</span></li>
  <li>í›ˆë ¨ ì‹ ê²½ë§ ê°€ì¤‘ì¹˜ ì¡°ì‘ ë°©ë²• <span style="color: blue">How to adjust weights</span></li>
</ol>

<h1 id="background-knowledge">Background knowledge</h1>

<h2 id="cifar-10">CIFAR-10</h2>
<p><img src="https://user-images.githubusercontent.com/39285147/180509114-3b492055-56eb-42c6-85b8-80fb8e077546.png" alt="image" /></p>

<p>10ê°€ì§€ í´ë˜ìŠ¤ë¡œ ë‚˜ëˆ„ì–´ì ¸ ìˆëŠ” <strong>6ë§Œ ê°œì˜</strong> <strong>ì»¬ëŸ¬(RGB ì±„ë„)</strong> ì´ë¯¸ì§€ë¡œ êµ¬ì„±ëœë‹¤ (airplanes, cars, birds, cats, etc.). <span style="color: blue">Ten classes; each includes 60,000 color images </span></p>
<ul>
  <li>ì´ë¯¸ì§€ í•´ìƒë„ê°€ <strong>32x32</strong> í”½ì…€ë¡œ ë§¤ìš° ë‚®ë‹¤. <span style="color: blue">Image resolution = 32x32</span></li>
  <li>ê° í´ë˜ìŠ¤ë§ˆë‹¤ 6ì²œê°œì˜ ì´ë¯¸ì§€ê°€ ì¡´ì¬í•œë‹¤ (í´ë˜ìŠ¤ ë³„ ë§¤ìš° ê· ë“±í•œ ì´ë¯¸ì§€ ë¶„í¬). <span style="color: blue">Uniform image distribution by class</span></li>
</ul>

<p>ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œ ì£¼ì–´ì§„ ì…ë ¥ ì´ë¯¸ì§€ê°€ 10ê°œì˜ í´ë˜ìŠ¤ ì¤‘ ì–´ë””ì— ì†í•˜ëŠ”ì§€ ë¶„ë¥˜ ëª¨ë¸ì„ í•™ìŠµì‹œì¼œë³´ì. <span style="color: blue">Training the model to put new image into certain class</span></p>

<h2 id="convolutional-neural-network-cnn"><a href="https://github.com/hchoi256/ai-boot-camp/blob/main/ai/deep-learning/cnn.md">Convolutional Neural Network (CNN)</a></h2>
<p><img src="https://user-images.githubusercontent.com/39285147/180512062-48c118e4-c9d4-4ea6-8281-958201289626.png" alt="image" /></p>

<p>CNN ê´€ë ¨ ë°°ê²½ì§€ì‹ì€ ìƒê¸° ë§í¬ë¥¼ í†µí•´ ìˆ™ì§€í•´ì£¼ì„¸ìš”! <span style="color: blue">Please refer to the link above.</span></p>

<p><img src="https://user-images.githubusercontent.com/39285147/180513584-f47d8136-4cc3-473b-b85f-437ddd376101.png" alt="image" /></p>

<p>3x3 â€˜sharpenâ€™ ì»¤ë„ í•„í„°ë¥¼ ì ìš©í•˜ë©´ ì¸í’‹ ì´ë¯¸ì§€ì˜ 3x3 í”½ì…€ ë²”ìœ„ì— ëŒ€í•´ í•©ì„±ê³±ë§ˆë‹¤ ê°€ìš´ë° ê°’ì— ê°€ì¤‘ì¹˜ë¥¼ ë†’ê²Œì¤˜ì„œ ì¶œë ¥ ì´ë¯¸ì§€ì—ì„œ ê°€ìš´ë° í”½ì…€ì„ ëšœë ·í•˜ê²Œ ê°•ì¡°í•œë‹¤ (= ëª…í™•í•˜ê²Œ ë³´ì´ê²Œ í•œë‹¤). <span style="color: blue">Applying a 3x3 â€˜sharpenâ€™ kernel filter, the value in the center of convolution matrix takes a significant weight, which sharpens the image</span></p>

<h2 id="ì„±ëŠ¥ì§€í‘œ-key-performance-indicators-kpi">ì„±ëŠ¥ì§€í‘œ: Key Performance Indicators (KPI)</h2>
<p><img src="https://user-images.githubusercontent.com/39285147/180517136-7b390f93-0f67-4e21-9217-a482e74a1f41.png" alt="image" /></p>

<p><strong>Type I Error</strong>: ì•”ì´ ì—†ëŠ” í™˜ìì—ê²Œ ìˆë‹¤ê³  ì˜¤ì§„í•  í™•ë¥  <span style="color: blue">Probability of misdiagnosing a patient without cancer</span></p>

<p><strong>Type II Error</strong>: ì•”ì´ ìˆëŠ” í™˜ìì—ê²Œ ì—†ë‹¤ê³  ì˜¤ì§„í•  í™•ë¥  <span style="color: blue">Probability of misdiagnosing a patient with cancer</span></p>

<p><strong>Precision</strong>: ì•”ì´ ì—†ëŠ” í™˜ìì—ê²Œ ì—†ë‹¤ê³  ì˜ˆì¸¡í•  í™•ë¥  <span style="color: blue">Probability of misdiagnosing a patient without cancer</span></p>

<p><strong>Recall</strong>: ì•”ì´ ìˆëŠ” í™˜ìì—ê²Œ ìˆë‹¤ê³  ì˜ˆì¸¡í•  í™•ë¥  <span style="color: blue">Probability of misdiagnosing a patient with cancer</span></p>

<blockquote>
  <p><img src="https://user-images.githubusercontent.com/39285147/180517030-eedfd66d-7cd8-4109-9fb2-87f6a29d3c7c.png" alt="image" /></p>
</blockquote>

<h1 id="implementation">Implementation</h1>

<h2 id="observing-the-dataset">Observing the dataset</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span>

<span class="kn">from</span> <span class="nn">keras.datasets</span> <span class="kn">import</span> <span class="n">cifar10</span>
<span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span> <span class="p">,</span> <span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span> <span class="o">=</span> <span class="n">cifar10</span><span class="p">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="n">X_train</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    (50000, 32, 32, 3)
</code></pre></div></div>

<ul>
  <li><em># Images</em>: 50000ê°œ</li>
  <li><em>Image resolution</em>: 32x32</li>
  <li><em>RGB</em>: 3</li>
</ul>

<h2 id="data-visualization">Data visualization</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">i</span> <span class="o">=</span> <span class="mi">30009</span>
<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">y_train</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    1
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/39285147/180518417-37e04fc2-210e-40db-b111-e219b5d66a9b.png" alt="image" /></p>

<p>í´ë˜ìŠ¤ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì¸ë±ìŠ¤ê°€ 1ì¸ í´ë˜ìŠ¤, ì¦‰ â€˜Carsâ€™ì— ì†í•˜ëŠ” ì´ë¯¸ì§€ì¸ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. <span style="color: blue">Index 1 represetns â€˜Carsâ€™</span></p>

<p>ì´ì œ, í•œ ë²ˆì— ì—¬ëŸ¬ ì´ë¯¸ì§€ë¥¼ ë°°ì¶œí•˜ì—¬ ì§ê´€ì ìœ¼ë¡œ ë¹„êµí•´ë³´ì.<span style="color: blue"> Displaying multiple images at once for better intuition</span></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">W_grid</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1"># Grid width
</span><span class="n">L_grid</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1"># Grid height
</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">L_grid</span><span class="p">,</span> <span class="n">W_grid</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="p">.</span><span class="n">ravel</span><span class="p">()</span> <span class="c1"># 4x4 matrix --&gt; 16 elements 
</span><span class="n">n_training</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L_grid</span> <span class="o">*</span> <span class="n">W_grid</span><span class="p">):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_training</span><span class="p">)</span> <span class="c1"># pick a random number
</span>    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="n">y_train</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span> <span class="c1"># hide axis
</span>    
<span class="n">plt</span><span class="p">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">)</span> <span class="c1"># space out images
</span></code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/39285147/180518577-9f9298f7-ff70-4bf5-ba08-b353fa610a6a.png" alt="image" /></p>

<h2 id="data-preprocessing">Data Preprocessing</h2>

<h3 id="formatting-the-imagefloat32">Formatting the image(float32)</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'float32'</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'float32'</span><span class="p">)</span>

<span class="n">number_cat</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># number of classes
</span><span class="n">y_train</span>

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    array([[6],
        [9],
        [9],
        ...,
        [9],
        [1],
        [1]], dtype=uint8)
</code></pre></div></div>

<p>í´ë˜ìŠ¤ ì¸ë±ìŠ¤ë¡œ ì¢…ì†ë³€ìˆ˜ì¸ 2ì°¨ì› ë°°ì—´ì´ í‘œí˜„ëœ ê²ƒì„ í™•ì¸í•´ë³¼ ìˆ˜ ìˆë‹¤. <span style="color: blue">expressed as a 2-dimensional array</span></p>

<p>ê° ìˆ«ìëŠ” ì•ì„œ â€˜ë°ì´í„° ì‹œê°í™”â€™ ì˜ˆì œì—ì„œ ë³´ì•˜ë˜ í´ë˜ìŠ¤ ì¸ë±ìŠ¤ ë²ˆí˜¸ì´ë‹¤. <span style="color: blue">Each number represents the index of classes</span></p>

<p>ì´ë¥¼ ì¸ë±ìŠ¤ ë²ˆí˜¸ê°€ ì•„ë‹ˆë¼ â€˜One-Hot Encodingâ€™ ë°©ë²•ì„ í™œìš©í•˜ì—¬ ë²”ì£¼í™” ì‹œì¼œì„œ ì‹ ê²½ë§ í•™ìŠµ ì¸ìë¡œ ë§Œë“¤ì–´ë³´ì. <span style="color: blue">Performing categorization to the indexes using â€˜One-Hot Encodingâ€™</span></p>

<blockquote>
  <p>ì‹ ê²½ë§ì˜ í•™ìŠµ ë°ì´í„°ëŠ” â€˜numpy 2ì°¨ì› ë°°ì—´â€™ì´ì—¬ì•¼ í•œë‹¤. <span style="color: blue">Training dataset must be numpy 2-dimensional array</span></p>
</blockquote>

<h3 id="categorization-categorical-data">Categorization (Categorical Data)</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">keras</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">to_categorical</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">number_cat</span><span class="p">)</span> <span class="c1"># one-hot encoding
</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">to_categorical</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">number_cat</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    array([[0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 1.],
        [0., 0., 0., ..., 0., 0., 1.],
        ...,
        [0., 0., 0., ..., 0., 0., 1.],
        [0., 1., 0., ..., 0., 0., 0.],
        [0., 1., 0., ..., 0., 0., 0.]], dtype=float32)
</code></pre></div></div>

<h3 id="ì •ê·œí™”">ì •ê·œí™”</h3>
<p>ë…ë¦½ë³€ìˆ˜ë“¤ì€ í”½ì…€ì— í• ë‹¹ëœ [0, 255] ì‚¬ì´ì˜ ìˆ˜ì¹˜ì´ë¯€ë¡œ, [0, 1] ì‚¬ì´ ê°’ë“¤ë¡œ <em>ì •ê·œí™”</em>ë¥¼ ê±°ì¹  í•„ìš”ê°€ ìˆë‹¤. <span style="color: blue">Independent variables are in range [0, 255], so they need to be normalized</span></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">/</span><span class="mi">255</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">/</span><span class="mi">255</span>
</code></pre></div></div>

<p>ì´ë ‡ê²Œ 255ë¡œ ë‚˜ëˆ„ì–´ì£¼ë©´ ê° ë°ì´í„°ë“¤ì€ [0, 1] ì‚¬ì´ ê°’ì„ ê°€ì§€ê²Œ ëœë‹¤. <span style="color: blue">Dividing by 255 makes the data become a number in range [0, 1]</span></p>

<h2 id="ëª¨ë¸-í›ˆë ¨í•˜ê¸°">ëª¨ë¸ í›ˆë ¨í•˜ê¸°</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span> 
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Conv2D</span><span class="p">,</span> <span class="n">MaxPooling2D</span><span class="p">,</span> <span class="n">AveragePooling2D</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Flatten</span><span class="p">,</span> <span class="n">Dropout</span>
<span class="kn">from</span> <span class="nn">keras.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span>
<span class="kn">from</span> <span class="nn">keras.callbacks</span> <span class="kn">import</span> <span class="n">TensorBoard</span> <span class="c1"># TensorFlow Visualization Tool
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cnn_model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="n">cnn_model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">activation</span> <span class="o">=</span> <span class="s">'relu'</span><span class="p">,</span> <span class="n">input_shape</span> <span class="o">=</span> <span class="n">Input_shape</span><span class="p">))</span>
<span class="n">cnn_model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">activation</span> <span class="o">=</span> <span class="s">'relu'</span><span class="p">))</span>
<span class="n">cnn_model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">MaxPooling2D</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">cnn_model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.4</span><span class="p">))</span>


<span class="n">cnn_model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span> <span class="n">kernel_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">activation</span> <span class="o">=</span> <span class="s">'relu'</span><span class="p">))</span>
<span class="n">cnn_model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span> <span class="n">kernel_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">activation</span> <span class="o">=</span> <span class="s">'relu'</span><span class="p">))</span>
<span class="n">cnn_model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">MaxPooling2D</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">cnn_model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.4</span><span class="p">))</span>

<span class="n">cnn_model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Flatten</span><span class="p">())</span>

<span class="n">cnn_model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">activation</span> <span class="o">=</span> <span class="s">'relu'</span><span class="p">))</span>

<span class="n">cnn_model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">activation</span> <span class="o">=</span> <span class="s">'relu'</span><span class="p">))</span>

<span class="n">cnn_model</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">activation</span> <span class="o">=</span> <span class="s">'softmax'</span><span class="p">))</span> <span class="c1"># ìµœì¢… ì¶œë ¥ í´ë˜ìŠ¤ ê°œìˆ˜ 10ê°œ # final output class = 10
</span>
<span class="n">cnn_model</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">loss</span> <span class="o">=</span> <span class="s">'categorical_crossentropy'</span><span class="p">,</span> <span class="n">optimizer</span> <span class="o">=</span> <span class="n">keras</span><span class="p">.</span><span class="n">optimizers</span><span class="p">.</span><span class="n">rmsprop</span><span class="p">(</span><span class="n">lr</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">),</span> <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s">'accuracy'</span><span class="p">])</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">cnn_model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span> <span class="n">epochs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shuffle</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>ReLU: íšŒê·€ ì‘ì—… ê´€ë ¨ í•¨ìˆ˜ë¡œ ì—°ì†ì ì¸ ì¶œë ¥ê°’ì„ ìƒì„±í•œë‹¤  <span style="color: blue">Continuous output</span></p>
</blockquote>

<blockquote>
  <p>Softmax: ë¶„ë¥˜ì— ì‚¬ìš©ëœë‹¤. <span style="color: blue"> classification</span></p>
</blockquote>

<blockquote>
  <p>CPU vs. GPU</p>

  <p>CPUëŠ” ì§ë ¬, GPUëŠ” ë³‘ë ¹ ì²˜ë¦¬ì— ê°ê° ëŠ¥í•˜ë‹¤. ë”°ë¼ì„œ, í•˜ë‚˜ì˜ í•™ìŠµì´ ì˜¤ë˜ ì§€ì†ë  í•„ìš”ê°€ ìˆëŠ” ê²½ìš° GPUê°€ ì•„ë‹Œ CPUë¥¼ ì‚¬ìš©í•˜ë©´ ë³´ë‹¤ ëŠ¥ë¥ ì ì¸ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.<span style="color: blue"> CPU &lt;=&gt; serialization, GPU &lt;=&gt; parellelism. Thus, if one training lasts for long, CPU is better than GPU</span></p>
</blockquote>

<blockquote>
  <p>ANN ì€ë‹‰ì¸µ <em>ë‰´ëŸ°ê°œìˆ˜</em>ì™€ CNN <em>í•„í„°ê°œìˆ˜</em>ë¥¼ ì¦ê°€ì‹œí‚¤ë©´, ëª¨ë¸ ë³µì¡ë„ê°€ ì¦ê°€í•˜ì—¬ í•™ìŠµ ì‹œê°„ì´ ëŠ˜ì–´ë‚œë‹¤. <span style="color: blue">The more neurons in the hidden layer of an ANN and more filters in the CNN, the more complex the model and the longer it takes to train.</span></p>
</blockquote>

<h2 id="evaluating-the-model">Evaluating the model</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">evaluation</span> <span class="o">=</span> <span class="n">cnn_model</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>

<span class="n">predicted_classes</span> <span class="o">=</span> <span class="n">cnn_model</span><span class="p">.</span><span class="n">predict_classes</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="n">y_test</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># one hot(binary) --&gt; decimal
</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">W</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="p">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="o">*</span><span class="n">W</span><span class="p">):</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">imshow</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Prediction = {}</span><span class="se">\n</span><span class="s"> True = {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">predicted_classes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y_test</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>    
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/39285147/180562014-e6d8d90f-7dc5-449f-a7cb-233e50bd6fa3.png" alt="image" /></p>

<p>ì´ë¯¸ì§€ëŠ” ê²°ê³¼ì˜ í•œ í–‰ì„ ë³´ì—¬ì¤€ë‹¤.<span style="color: blue"> Showing one row of the result</span></p>

<p>í•´ë‹¹ í–‰ì— ëŒ€í•˜ì—¬ ì„¸ ë²ˆì§¸ì™€ ë§ˆì§€ë§‰ ì—´ì„ ì œì™¸í•˜ê³ , ë¶„ë¥˜ê¸°ê°€ ëª¨ë‘ ì˜¬ë°”ë¥¸ ì˜ˆì¸¡ì„ í•´ë‚¸ ê²ƒì‹ í™•ì¸í•´ë³¼ ìˆ˜ ìˆë‹¤. <span style="color: blue">Excluding the third and last column on the row, the classifier performs prediction successfully </span></p>

<p>ì—¬ê¸°ì„œëŠ” ì •í™•ë„ë¥¼ ê²°ê³¼ê°’ìœ¼ë¡œ ë”°ë¡œ ë³´ì—¬ì£¼ì§€ ì•Šì•˜ì§€ë§Œ, ì •í™•ë„ëŠ” â€˜evaluationâ€™ ë³€ìˆ˜ì— ë‹´ê²¨ìˆë‹¤. <span style="color: blue">The accuracy is in â€˜evaluationâ€™</span></p>

<p>ì´ì œ í˜¼ë™ í–‰ë ¬ì„ ì‚¬ìš©í•˜ì—¬ ë³´ë‹¤ ì§ê´€ì ìœ¼ë¡œ í‰ê°€ì§€í‘œë¥¼ ë¶„ì„í•´ë³´ì. <span style="color: blue">How can we analyze the model performance using confusion matrix?</span></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>

<span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predicted_classes</span><span class="p">)</span>
<span class="n">cm</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="p">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">annot</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span> <span class="c1"># í•´ë‹¹ ë°ì´í„°ê°€ ë§ê±°ë‚˜ ë†’ì€ ê²½ìš° ìƒ‰ì„ ì‚¬ìš©í•´ ì‹œê°í™”í•˜ëŠ” ê·¸ë˜í”„ color visualization in case that data å¤š
</span></code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/39285147/180563602-b9035fea-733c-4514-a223-63c1e99608a6.png" alt="image" /></p>

<p>ëŒ€ê°ì„ ì— ìœ„ì¹˜í•œ í”½ì…€ë“¤ì€ â€˜True Positiveâ€™ê³¼ â€˜True Negativeâ€™ë¡œ ëª¨ë¸ì´ ì‹¤ì œê°’ê³¼ ì¼ì¹˜í•˜ëŠ” ë°ì´í„°ë“¤ ê°œìˆ˜ë¥¼ ë‹´ê³ ìˆë‹¤. <span style="color: blue">â€˜TPâ€™ and â€˜TNâ€™ on the diagonal include the number of correct predictions</span></p>

<p>ê·¸ ì™¸ ë‹¤ë¥¸ ëª¨ë“  í”½ì…€ì— ì†í•œ ìˆ˜ì¹˜ë“¤ì€ ì˜¤ë¶„ë¥˜(â€˜False Negativeâ€™, â€˜False Positiveâ€™)ë¡œ ì·¨ê¸‰í•œë‹¤. <span style="color: blue"> Other pixels (â€˜FNâ€™, â€˜FPâ€™) are errors</span></p>

<h2 id="saving-the-model">Saving the model</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span> 
<span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s">'saved_models'</span><span class="p">)</span> <span class="c1"># getcwd: get current working directory
</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
    <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
<span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s">'keras_cifar10_trained_model.h5'</span><span class="p">)</span>
<span class="n">cnn_model</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="image-augmentation">Image Augmentation</h2>

<p>ê³¼ì í•© ë¬¸ì œë¥¼ í•´ì†Œí•˜ê³  ì •í™•ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ ê¸°ì¡´ ë°ì´í„°ì— ë³€í™”ë¥¼ ì ìš©í•˜ëŠ” ì „ì²˜ë¦¬ ê¸°ë²•ì´ë‹¤. <span style="color: blue">Applying changes to existing data to solve overfitting problems and increase accuracy.</span></p>

<p>ê¸°ì¡´ ì¸í’‹ ì´ë¯¸ì§€ì— ë’¤ì§‘ê¸°, íšŒì „ ë“± ë‹¤ì–‘í•œ ë³€í™”ë¥¼ ì£¼ì–´ í•™ìŠµí•˜ëŠ” ë°ì´í„°ëŸ‰ì„ ì¦ê°€ì‹œí‚¤ê³ , ë°ì´í„° ì°¨ì›ì´ ëª¨ë¸ ë³µì¡ë„ë¥¼ ì›ƒëŒê²Œ ë§Œë“ ë‹¤. <span style="color: blue">By applying various changes (i.e., flipping, rotation, etc.) to the existing input image, it increases the amount of learning data and makes the data dimension exceed the model complexity.</span></p>

<blockquote>
  <p><em>ImageDataGenerator</em> í´ë˜ìŠ¤ë¥¼ í†µí•´ ì´ë¯¸ì§€ë‚´ ì—¬ëŸ¬ ë³€í™”ë¥¼ ëŒì–´ë‚¸ë‹¤. <span style="color: blue">various changes to images</span></p>
</blockquote>

<p>ì´ëŠ” ì°¨í›„ ê³¼ì í•© ë°©ì§€ì— íš¨ê³¼ê°€ ìˆë‹¤. <span style="color: blue">Avoiding overfitting</span></p>

<h3 id="new-dataset-with-image-augmentation">New dataset with image augmentation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">keras</span>
<span class="kn">from</span> <span class="nn">keras.datasets</span> <span class="kn">import</span> <span class="n">cifar10</span>
<span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">),</span> <span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span> <span class="o">=</span> <span class="n">cifar10</span><span class="p">.</span><span class="n">load_data</span><span class="p">()</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'float32'</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'float32'</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">8</span> 
<span class="n">X_train_sample</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span> <span class="c1"># 8ê°œì˜ ìƒ˜í”Œ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¨ë‹¤ Loading 8 samples
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">keras.preprocessing.image</span> <span class="kn">import</span> <span class="n">ImageDataGenerator</span>

<span class="c1"># dataget_train = ImageDataGenerator(rotation_range = 90) # rotation
# dataget_train = ImageDataGenerator(vertical_flip=True) # flipping/inversion
# dataget_train = ImageDataGenerator(height_shift_range=0.5) # ì´ë¯¸ì§€ í‰ë©´ ìœ„ì¹˜ ì´ë™ move image plane position
</span><span class="n">dataget_train</span> <span class="o">=</span> <span class="n">ImageDataGenerator</span><span class="p">(</span><span class="n">brightness_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="c1"># brightness
</span>
<span class="n">dataget_train</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_sample</span><span class="p">)</span> <span class="c1"># applying the image genearter
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">scipy.misc</span> <span class="kn">import</span> <span class="n">toimage</span> <span class="c1"># array to image
</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># ìƒˆë¡œ ìƒì„±ë  ì´ë¯¸ì§€ ì‚¬ì´ì¦ˆ ì¡°ì • adjusting the size of new image
</span>
<span class="c1"># í›ˆë ¨ ìƒ˜í”Œì„ ê°€ì ¸ì™€ ì´ë¯¸ì§€ flowë¥¼ ìƒì„±í•œë‹¤. Creating the image flow with the training dataset
# ë³€í˜•ëœ ì´ë¯¸ì§€ë¥¼ ë°°ì¹˜ ë‹¨ìœ„ë¡œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆëŠ” Generator(*flow()*)ì„ ìƒì„±í•´ ì¤€ë‹¤ (8ê°œ ìš”ì†Œ í¬í•¨í•˜ëŠ” ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ í•œ ë²ˆì— ê°€ì ¸ì˜¤ê²Œ ëœë‹¤) Loading the certain number of adjusted images
</span><span class="k">for</span> <span class="n">x_batch</span> <span class="ow">in</span> <span class="n">dataget_train</span><span class="p">.</span><span class="n">flow</span><span class="p">(</span><span class="n">X_train_sample</span><span class="p">,</span> <span class="n">batch_size</span> <span class="o">=</span> <span class="n">n</span><span class="p">):</span>
     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">toimage</span><span class="p">(</span><span class="n">x_batch</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
     <span class="n">fig</span><span class="p">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">'Augmented images (rotated 90 degrees)'</span><span class="p">)</span>
     <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
     <span class="k">break</span><span class="p">;</span>
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/39285147/180567864-9bef861d-2973-4367-9344-436ae78ee7c9.png" alt="image" /></p>

<p>ì´ë¯¸ì§€ ì¦ê°ì„ ì´ìš©í•˜ì—¬ ê¸°ì¡´ ë°ì´í„°ì—ì„œ ìƒˆë¡œìš´ ë°ì´í„°ë¡œ ê°œìˆ˜ë¥¼ ë¶€í’€ë¦° ì˜ˆì‹œì´ë‹¤. <span style="color: blue">This is an example of inflating the number from existing data to new data using image increase/decrease.</span></p>

<p>ê²°ê³¼ì—ì„œ ë³´ì´ëŠ” ê²ƒì²˜ëŸ¼ ê¸°ì¡´ ì¸í’‹ ì´ë¯¸ì§€ì˜ â€˜ë°ê¸°â€™ë¥¼ ìˆ˜ì •í•˜ì—¬ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ëƒˆë‹¤! <span style="color: blue">New data was created by modifying the â€˜brightnessâ€™ of the existing input image! </span></p>

<h3 id="training-the-model-with-image-augmentation">Training the model with image augmentation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">keras.preprocessing.image</span> <span class="kn">import</span> <span class="n">ImageDataGenerator</span>

<span class="n">datagen</span> <span class="o">=</span> <span class="n">ImageDataGenerator</span><span class="p">(</span>
                            <span class="n">rotation_range</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span>
                            <span class="n">width_shift_range</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
                            <span class="n">horizontal_flip</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                            <span class="n">vertical_flip</span> <span class="o">=</span> <span class="bp">True</span>
                             <span class="p">)</span>

<span class="n">datagen</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="n">cnn_model</span><span class="p">.</span><span class="n">fit_generator</span><span class="p">(</span><span class="n">datagen</span><span class="p">.</span><span class="n">flow</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span><span class="p">),</span> <span class="n">epochs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># ì´ë¯¸ì§€ ìƒì„±ê¸°ë¡œ ë§Œë“  ë°ì´í„°ë¥¼ í•™ìŠµì— ì´ìš©í•  ë•Œ fit_generator() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œë‹¤ fit_generator() when using data made by image generator
</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">cnn_model</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Test accuracy'</span><span class="p">,</span> <span class="n">score</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># save the model
</span><span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s">'saved_models'</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
    <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
<span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s">'keras_cifar10_trained_model_Augmentation.h5'</span><span class="p">)</span>
<span class="n">cnn_model</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
</code></pre></div></div>
:ET